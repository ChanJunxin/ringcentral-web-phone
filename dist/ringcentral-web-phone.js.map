{"version":3,"sources":["webpack://RingCentral.WebPhone/webpack/universalModuleDefinition","webpack://RingCentral.WebPhone/webpack/bootstrap","webpack://RingCentral.WebPhone/external {\"commonjs\":\"sip.js\",\"commonjs2\":\"sip.js\",\"amd\":\"sip.js\",\"root\":\"SIP\"}","webpack://RingCentral.WebPhone/./src/constants.ts","webpack://RingCentral.WebPhone/./src/utils.ts","webpack://RingCentral.WebPhone/./src/mediaStreams.ts","webpack://RingCentral.WebPhone/./node_modules/sip.js/lib/Enums.js","webpack://RingCentral.WebPhone/./node_modules/sip.js/lib/Web/SessionDescriptionHandlerObserver.js","webpack://RingCentral.WebPhone/./src/index.ts","webpack://RingCentral.WebPhone/./src/userAgent.ts","webpack://RingCentral.WebPhone/./src/audioHelper.ts","webpack://RingCentral.WebPhone/./src/session.ts","webpack://RingCentral.WebPhone/./src/qos.ts","webpack://RingCentral.WebPhone/external {\"commonjs\":\"getstats\",\"commonjs2\":\"getstats\",\"amd\":\"getstats\",\"root\":\"getStats\"}","webpack://RingCentral.WebPhone/./src/rtpReport.ts","webpack://RingCentral.WebPhone/./src/sipTransportConstructor.ts","webpack://RingCentral.WebPhone/./src/DefaultSessionDescriptionHandler.ts","webpack://RingCentral.WebPhone/(webpack)/buildin/global.js","webpack://RingCentral.WebPhone/./node_modules/events/events.js","webpack://RingCentral.WebPhone/./node_modules/sip.js/lib/Web/Modifiers.js"],"names":[],"mappings":"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AACD;AACA;AACA;;AAEA;AACA;AACA,4CAA4C;;AAE5C;;;;;;;;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEa;;AAEb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,sBAAsB;AACvC;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA,cAAc;AACd;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA,mBAAmB,SAAS;AAC5B;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,sBAAsB;AACvC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA,iCAAiC,QAAQ;AACzC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,OAAO;AACP;AACA,sCAAsC,QAAQ;AAC9C;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,OAAO;AACxB;AACA;AACA;;AAEA;AACA,QAAQ,yBAAyB;AACjC;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,gBAAgB;AACjC;AACA;AACA;AACA;;;;;;;;AC/ba;AACb,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA,+CAA+C,0BAA0B;AACzE;AACA;AACA;AACA,uBAAuB,kBAAkB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA","file":"ringcentral-web-phone.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"sip.js\"), require(\"getstats\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"sip.js\", \"getstats\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"WebPhone\"] = factory(require(\"sip.js\"), require(\"getstats\"));\n\telse\n\t\troot[\"RingCentral\"] = root[\"RingCentral\"] || {}, root[\"RingCentral\"][\"WebPhone\"] = factory(root[\"SIP\"], root[\"getStats\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__0__, __WEBPACK_EXTERNAL_MODULE__11__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","export const messages = {\n    park: {reqid: 1, command: 'callpark'},\n    startRecord: {reqid: 2, command: 'startcallrecord'},\n    stopRecord: {reqid: 3, command: 'stopcallrecord'},\n    flip: {reqid: 3, command: 'callflip', target: ''},\n    monitor: {reqid: 4, command: 'monitor'},\n    barge: {reqid: 5, command: 'barge'},\n    whisper: {reqid: 6, command: 'whisper'},\n    takeover: {reqid: 7, command: 'takeover'},\n    toVoicemail: {reqid: 11, command: 'toVoicemail'},\n    ignore: {reqid: 12, command: 'ignore'},\n    receiveConfirm: {reqid: 17, command: 'receiveConfirm'},\n    replyWithMessage: {reqid: 14, command: 'replyWithMessage'}\n};\n\nexport const uuidKey = 'rc-webPhone-uuid';\n\nexport const responseTimeout = 60000;\n\nexport const defaultMediaConstraints = {\n    audio: true,\n    video: false\n};\n","export const uuid = (): string =>\n    'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {\n        const r = (Math.random() * 16) | 0;\n        const v = c === 'x' ? r : (r & 0x3) | 0x8;\n        return v.toString(16);\n    });\n\nexport const delay = async (ms: number): Promise<any> => new Promise(resolve => setTimeout(resolve, ms));\n\nexport const extend = (dst: any = {}, src: any = {}): any => Object.assign(dst || {}, src || {});\n","/*\n * @Author: Elias Sun(elias.sun@ringcentral.com)\n * @Date: Dec. 15, 2018\n * Copyright © RingCentral. All rights reserved.\n */\n\n/**\n * @Supported browsers: @Chrome  @Firefox @Safari\n *\n * @Section1 @type MediaStreams public interfaces\n *\n * @release : release the resource after the call is ended.\n * @param : none\n *\n * @reconnectMedia : reconnect media streams in a call at any time.\n * @param : none\n *\n * @getMediaStats : get the media RTP statistics\n * @param1 onMediaStat : @optional  @callback function to receive the RTP statistics report.\n *   Ways to receive media report:\n *   @way1 onMediaStat = function(report) {...}\n *   @way2 session.on(\"rtpStat\") to listen on the event\n *   @way3 session.onRTPStat = function(report)\n *   @way4 session.mediaStreams.onRTPStat = function(report)\n * @param2 interval : @optional  the interval in seconds to fetch a media statistics report. 1 second by default.\n * @return: @inboundRtpReport : bytesReceived, jitter, packetsLost, packetsReceived, mediaType, fractionLostIn\n *          @outboundRtpReport : bytesSent, packetsSent, mediaType\n *          @rttMS : currentRoundTripTime\n *\n * @stopMediaStats :stop the media statistics\n * @param : none\n *\n * @Section2 @type MediaStreams public properties\n *\n * @property onRTPStat : @optional @callback function to receive the RTP statistics report.\n * @property onMediaConnectionStateChange : @optional @callback function to receive media connectionState\n *   Ways to receive the media connection state\n *   @way1 session.onMediaConnectionStateChange = function(session, event) {...}\n *   @way2 session.mediaStreams.onMediaConnectionStateChange = function(session, event) {...}\n *   @way3 session.on(event)  event = element in connectionState\n *\n * @Section3 @type MediaStreams public events\n * @connectionState : media connection state. @emit :\n *   @state1 'mediaConnectionStateNew' : A new RTCPeerConnection is created.\n *   @state2 'mediaConnectionStateChecking' : A new RTCPeerConnection is created.\n *   @state3 'mediaConnectionStateConnected' : RTCPeerConnection media connection is connected.\n *   @state4 'mediaConnectionStateCompleted' : RTCPeerConnection media connection is ready.\n *   @state5 'mediaConnectionStateFailed' : RTCPeerConnection media connection is failed.\n *   @state6 'mediaConnectionStateDisconnected': RTCPeerConnection media connection is disconnected.\n *   @state7 'mediaConnectionStateClosed' : RTCPeerConnection media connection is closed.\n */\n\nenum ConnectionState {\n    new = 'mediaConnectionStateNew',\n    checking = 'mediaConnectionStateChecking',\n    connected = 'mediaConnectionStateConnected',\n    completed = 'mediaConnectionStateCompleted',\n    failed = 'mediaConnectionStateFailed',\n    disconnected = 'mediaConnectionStateDisconnected',\n    closed = 'mediaConnectionStateClosed'\n}\n\nexport enum Browsers {\n    MSIE = 'IE',\n    Chrome = 'Chrome',\n    Firefox = 'Firefox',\n    Safari = 'Safari',\n    Opera = 'Opera'\n}\n\nexport class RTPReport {\n    public outboundRtpReport: any;\n    public inboundRtpReport: any;\n    public rttMS: any;\n\n    public constructor() {\n        this.outboundRtpReport = {};\n        this.inboundRtpReport = {};\n        this.rttMS = {};\n    }\n}\n\nexport default class MediaStreams {\n    public mediaStreamsImpl: MediaStreamsImpl;\n    public release: any;\n    public reconnectMedia: any;\n    public getMediaStats: any;\n    public stopMediaStats: any;\n\n    public constructor(session) {\n        this.mediaStreamsImpl = new MediaStreamsImpl(session);\n        this.release = this.mediaStreamsImpl.release.bind(this.mediaStreamsImpl);\n        this.reconnectMedia = this.mediaStreamsImpl.reconnectMedia.bind(this.mediaStreamsImpl);\n        this.getMediaStats = this.mediaStreamsImpl.getMediaStats.bind(this.mediaStreamsImpl);\n        this.stopMediaStats = this.mediaStreamsImpl.stopMediaStats.bind(this.mediaStreamsImpl);\n    }\n\n    public set onRTPStat(statsCallback) {\n        this.mediaStreamsImpl.onRTPStat = statsCallback;\n    }\n\n    public set onMediaConnectionStateChange(stateChangeCallBack) {\n        this.mediaStreamsImpl.onMediaConnectionStateChange = stateChangeCallBack;\n    }\n}\n\n/**\n * MediaStreams Implementation\n */\nexport class MediaStreamsImpl {\n    public onMediaConnectionStateChange: any;\n    public onRTPStat: any;\n    public on;\n    public localStream;\n    public remoteStream;\n    public validateSDP;\n    public preRTT: any;\n\n    private ktag = 'MediaStreams';\n    private session: any;\n    private onStateChange: any;\n    private isChrome: any;\n    private isFirefox: any;\n    private isSafari: any;\n    private mediaStatsTimer: any;\n\n    public constructor(session) {\n        this.ktag = 'MediaStreams';\n        if (!session) {\n            this.rcWPLoge(this.ktag, 'The session cannot be null!');\n            throw new Error('Fail to create the media session. session is null or undefined!');\n        }\n        this.session = session;\n        this.onMediaConnectionStateChange = null;\n        this.onStateChange = this.onPeerConnectionStateChange.bind(this);\n        if (this.session && this.session.sessionDescriptionHandler) {\n            this.session.sessionDescriptionHandler.on('iceConnection', this.onStateChange);\n            this.session.sessionDescriptionHandler.on('iceConnectionChecking', this.onStateChange);\n            this.session.sessionDescriptionHandler.on('iceConnectionConnected', this.onStateChange);\n            this.session.sessionDescriptionHandler.on('iceConnectionCompleted', this.onStateChange);\n            this.session.sessionDescriptionHandler.on('iceConnectionFailed', this.onStateChange);\n            this.session.sessionDescriptionHandler.on('iceConnectionDisconnected', this.onStateChange);\n            this.session.sessionDescriptionHandler.on('iceConnectionClosed', this.onStateChange);\n        }\n        this.isChrome = this.browser() === Browsers['Chrome'];\n        this.isFirefox = this.browser() === Browsers['Firefox'];\n        this.isSafari = this.browser() === Browsers['Safari'];\n\n        this.preRTT = {currentRoundTripTime: 0};\n\n        if (!this.isChrome && !this.isFirefox && !this.isSafari) {\n            this.rcWPLoge(\n                this.ktag,\n                `The web browser ${this.browser()} is not in the recommended list [Chrome, Safari, Firefox] !`\n            );\n        }\n    }\n\n    public getMediaStats(onMediaStat = null, interval = 1000) {\n        if (onMediaStat) {\n            this.onRTPStat = onMediaStat;\n        }\n        if (this.mediaStatsTimer) {\n            clearTimeout(this.mediaStatsTimer);\n            this.mediaStatsTimer = null;\n        }\n        this.mediaStatsTimer = setInterval(() => {\n            this.mediaStatsTimerCallback();\n        }, interval);\n    }\n\n    public mediaStatsTimerCallback() {\n        const pc = this.session.sessionDescriptionHandler.peerConnection;\n        if (!pc) {\n            this.rcWPLoge(this.ktag, 'the peer connection cannot be null');\n            return;\n        }\n        const connectionState = pc.iceConnectionState;\n        if (connectionState !== 'connected' && connectionState !== 'completed') {\n            this.preRTT['currentRoundTripTime'] = 0;\n            return;\n        }\n        const rtpStatInSession = this.session.listeners('rtpStat');\n        if (!this.session.onRTPStat && !this.onRTPStat && rtpStatInSession.length <= 0) {\n            this.rcWPLoge(\n                this.ktag,\n                'No callback to accept receive media report. usage: session.on(\"rtpStat\") = function(report) or session.onRTPStat = function(report) or set a mediaCallback as a paramter'\n            );\n            return;\n        }\n        this.getRTPReport(new RTPReport());\n    }\n\n    public stopMediaStats() {\n        if (this.mediaStatsTimer) {\n            clearTimeout(this.mediaStatsTimer);\n            this.onRTPStat = null;\n        }\n    }\n\n    private get tag() {\n        return this.ktag;\n    }\n\n    public onPeerConnectionStateChange(sessionDescriptionHandler) {\n        let eventState = 'unknown';\n        if (ConnectionState.hasOwnProperty(sessionDescriptionHandler.peerConnection.iceConnectionState)) {\n            eventState = ConnectionState[sessionDescriptionHandler.peerConnection.iceConnectionState];\n            if (this.onMediaConnectionStateChange) {\n                this.onMediaConnectionStateChange(this.session, eventState);\n            } else if (this.session && this.session.onMediaConnectionStateChange) {\n                this.session.onMediaConnectionStateChange(this.session, eventState);\n            } else {\n                this.session.emit(eventState);\n            }\n        } else {\n            this.rcWPLogd(\n                this.tag,\n                `Unknown peerConnection state: ${sessionDescriptionHandler.peerConnection.iceConnectionState}`\n            );\n        }\n        this.rcWPLogd(this.tag, `peerConnection State: ${eventState}`);\n    }\n\n    public reconnectMedia(options?: any) {\n        const self = this;\n        return new Promise(async function(resolve, reject) {\n            if (self.session) {\n                const RTCOptions = {\n                    offerToReceiveAudio: 1,\n                    offerToReceiveVideo: 0,\n                    iceRestart: true\n                };\n                const offerOptions = (options && options.RTCOptions) || RTCOptions;\n                if (!options) {\n                    options = {};\n                }\n                if (!options.extraHeaders) {\n                    options.extraHeaders = self.session.ua.defaultHeaders;\n                }\n                options.eventHandlers = {\n                    succeeded: resolve,\n                    failed: reject\n                };\n                const pc = self.session.sessionDescriptionHandler.peerConnection;\n                let offer: any;\n                try {\n                    offer = await pc.createOffer(offerOptions);\n                    self.session.sessionDescriptionHandler.on('iceCandidate', self.onIceCandidate);\n                    await pc.setLocalDescription(offer);\n                    self.rcWPLogd(self.tag, 'reconnecting media');\n                    resolve('reconnecting media');\n                } catch (e) {\n                    self.rcWPLoge(self.tag, e);\n                    reject(e);\n                }\n            } else {\n                self.rcWPLoge(self.tag, 'The session cannot be empty');\n            }\n        });\n    }\n\n    private onIceCandidate = (event: any) => {\n        if (event.candidate === null) {\n            this.rcWPLogd(this.tag, 'ice candidate completed for reconnect media');\n            this.session.sessionDescriptionHandler.off('iceCandidate', this.onIceCandidate);\n            this.session.reinvite();\n        }\n    };\n\n    public getRTPReport(reports) {\n        const self = this;\n        const pc = self.session.sessionDescriptionHandler.peerConnection;\n        pc.getStats()\n            .then(stats => {\n                stats.forEach(report => {\n                    switch (report.type) {\n                        case 'inbound-rtp':\n                            Object.keys(report).forEach(statName => {\n                                switch (statName) {\n                                    case 'bytesReceived':\n                                    case 'packetsReceived':\n                                    case 'jitter':\n                                    case 'packetsLost':\n                                    case 'fractionLost':\n                                    case 'mediaType':\n                                        reports.inboundRtpReport[statName] = report[statName];\n                                        break;\n                                    case 'roundTripTime':\n                                        reports.rttMS[statName] = report[statName];\n                                        break;\n                                }\n                            });\n                            break;\n                        case 'outbound-rtp':\n                            Object.keys(report).forEach(statName => {\n                                switch (statName) {\n                                    case 'bytesSent':\n                                    case 'packetsSent':\n                                    case 'mediaType':\n                                        reports.outboundRtpReport[statName] = report[statName];\n                                        break;\n                                }\n                            });\n                            break;\n                        case 'candidate-pair':\n                            Object.keys(report).forEach(statName => {\n                                switch (statName) {\n                                    case 'currentRoundTripTime':\n                                        reports.rttMS[statName] = report[statName];\n                                        break;\n                                }\n                            });\n                            break;\n                        case 'media-source':\n                            reports.outboundRtpReport['rtpLocalAudioLevel'] = report.audioLevel ? report.audioLevel : 0;\n                            break;\n                        case 'track':\n                            if (!report.remoteSource) {\n                                break;\n                            }\n                            reports.inboundRtpReport['rtpRemoteAudioLevel'] = report.audioLevel ? report.audioLevel : 0;\n                            break;\n                        default:\n                            break;\n                    }\n                });\n\n                if (!reports.rttMS.hasOwnProperty('currentRoundTripTime')) {\n                    if (!reports.rttMS.hasOwnProperty('roundTripTime')) {\n                        reports.rttMS['currentRoundTripTime'] = self.preRTT['currentRoundTripTime'];\n                    } else {\n                        reports.rttMS['currentRoundTripTime'] = reports.rttMS['roundTripTime']; // for Firefox\n                        delete reports.rttMS['roundTripTime'];\n                    }\n                } else {\n                    reports.rttMS['currentRoundTripTime'] = Math.round(reports.rttMS['currentRoundTripTime'] * 1000);\n                }\n\n                if (reports.rttMS.hasOwnProperty('currentRoundTripTime')) {\n                    self.preRTT['currentRoundTripTime'] = reports.rttMS['currentRoundTripTime'];\n                }\n\n                if (self.session) {\n                    if (self.session.onRTPStat) {\n                        self.session.onRTPStat(reports, self.session);\n                    } else if (self.onRTPStat) {\n                        self.onRTPStat(reports, self.session);\n                    } else {\n                        self.session.emit('rtpStat', reports, self.session);\n                    }\n                }\n            })\n            .catch(error => {\n                this.rcWPLoge(self.ktag, JSON.stringify(error));\n            });\n    }\n\n    public browser() {\n        if (navigator.userAgent.search('MSIE') >= 0) {\n            return Browsers['MSIE'];\n        } else if (navigator.userAgent.search('Chrome') >= 0) {\n            return Browsers['Chrome'];\n        } else if (navigator.userAgent.search('Firefox') >= 0) {\n            return Browsers['Firefox'];\n        } else if (navigator.userAgent.search('Safari') >= 0 && navigator.userAgent.search('Chrome') < 0) {\n            return Browsers['Safari'];\n        } else if (navigator.userAgent.search('Opera') >= 0) {\n            return Browsers['Opera'];\n        }\n        return 'unknown';\n    }\n\n    public release() {\n        if (this.mediaStatsTimer) {\n            clearTimeout(this.mediaStatsTimer);\n            this.mediaStatsTimer = null;\n        }\n        if (this.session) {\n            this.session.sessionDescriptionHandler.removeListener('iceConnection', this.onStateChange);\n            this.session.sessionDescriptionHandler.removeListener('iceConnectionChecking', this.onStateChange);\n            this.session.sessionDescriptionHandler.removeListener('iceConnectionConnected', this.onStateChange);\n            this.session.sessionDescriptionHandler.removeListener('iceConnectionCompleted', this.onStateChange);\n            this.session.sessionDescriptionHandler.removeListener('iceConnectionFailed', this.onStateChange);\n            this.session.sessionDescriptionHandler.removeListener('iceConnectionDisconnected', this.onStateChange);\n            this.session.sessionDescriptionHandler.removeListener('iceConnectionClosed', this.onStateChange);\n        }\n    }\n\n    private rcWPLoge(label, msg) {\n        if (this.session) {\n            this.session.logger.error(`${label} ${msg}`);\n        }\n    }\n\n    private rcWPLogd(label, msg) {\n        if (this.session) {\n            this.session.logger.log(`${label} ${msg}`);\n        }\n    }\n}\n\nexport {MediaStreams};\n","\"use strict\";\n// enums can't really be declared, so they are set here.\n// pulled out of individual files to avoid circular dependencies\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar DialogStatus;\n(function (DialogStatus) {\n    DialogStatus[DialogStatus[\"STATUS_EARLY\"] = 1] = \"STATUS_EARLY\";\n    DialogStatus[DialogStatus[\"STATUS_CONFIRMED\"] = 2] = \"STATUS_CONFIRMED\";\n})(DialogStatus = exports.DialogStatus || (exports.DialogStatus = {}));\nvar SessionStatus;\n(function (SessionStatus) {\n    // Session states\n    SessionStatus[SessionStatus[\"STATUS_NULL\"] = 0] = \"STATUS_NULL\";\n    SessionStatus[SessionStatus[\"STATUS_INVITE_SENT\"] = 1] = \"STATUS_INVITE_SENT\";\n    SessionStatus[SessionStatus[\"STATUS_1XX_RECEIVED\"] = 2] = \"STATUS_1XX_RECEIVED\";\n    SessionStatus[SessionStatus[\"STATUS_INVITE_RECEIVED\"] = 3] = \"STATUS_INVITE_RECEIVED\";\n    SessionStatus[SessionStatus[\"STATUS_WAITING_FOR_ANSWER\"] = 4] = \"STATUS_WAITING_FOR_ANSWER\";\n    SessionStatus[SessionStatus[\"STATUS_ANSWERED\"] = 5] = \"STATUS_ANSWERED\";\n    SessionStatus[SessionStatus[\"STATUS_WAITING_FOR_PRACK\"] = 6] = \"STATUS_WAITING_FOR_PRACK\";\n    SessionStatus[SessionStatus[\"STATUS_WAITING_FOR_ACK\"] = 7] = \"STATUS_WAITING_FOR_ACK\";\n    SessionStatus[SessionStatus[\"STATUS_CANCELED\"] = 8] = \"STATUS_CANCELED\";\n    SessionStatus[SessionStatus[\"STATUS_TERMINATED\"] = 9] = \"STATUS_TERMINATED\";\n    SessionStatus[SessionStatus[\"STATUS_ANSWERED_WAITING_FOR_PRACK\"] = 10] = \"STATUS_ANSWERED_WAITING_FOR_PRACK\";\n    SessionStatus[SessionStatus[\"STATUS_EARLY_MEDIA\"] = 11] = \"STATUS_EARLY_MEDIA\";\n    SessionStatus[SessionStatus[\"STATUS_CONFIRMED\"] = 12] = \"STATUS_CONFIRMED\";\n})(SessionStatus = exports.SessionStatus || (exports.SessionStatus = {}));\nvar TransactionStatus;\n(function (TransactionStatus) {\n    // Transaction states\n    TransactionStatus[TransactionStatus[\"STATUS_TRYING\"] = 1] = \"STATUS_TRYING\";\n    TransactionStatus[TransactionStatus[\"STATUS_PROCEEDING\"] = 2] = \"STATUS_PROCEEDING\";\n    TransactionStatus[TransactionStatus[\"STATUS_CALLING\"] = 3] = \"STATUS_CALLING\";\n    TransactionStatus[TransactionStatus[\"STATUS_ACCEPTED\"] = 4] = \"STATUS_ACCEPTED\";\n    TransactionStatus[TransactionStatus[\"STATUS_COMPLETED\"] = 5] = \"STATUS_COMPLETED\";\n    TransactionStatus[TransactionStatus[\"STATUS_TERMINATED\"] = 6] = \"STATUS_TERMINATED\";\n    TransactionStatus[TransactionStatus[\"STATUS_CONFIRMED\"] = 7] = \"STATUS_CONFIRMED\";\n})(TransactionStatus = exports.TransactionStatus || (exports.TransactionStatus = {}));\nvar TypeStrings;\n(function (TypeStrings) {\n    TypeStrings[TypeStrings[\"AckClientTransaction\"] = 0] = \"AckClientTransaction\";\n    TypeStrings[TypeStrings[\"ClientContext\"] = 1] = \"ClientContext\";\n    TypeStrings[TypeStrings[\"ConfigurationError\"] = 2] = \"ConfigurationError\";\n    TypeStrings[TypeStrings[\"Dialog\"] = 3] = \"Dialog\";\n    TypeStrings[TypeStrings[\"DigestAuthentication\"] = 4] = \"DigestAuthentication\";\n    TypeStrings[TypeStrings[\"DTMF\"] = 5] = \"DTMF\";\n    TypeStrings[TypeStrings[\"IncomingMessage\"] = 6] = \"IncomingMessage\";\n    TypeStrings[TypeStrings[\"IncomingRequest\"] = 7] = \"IncomingRequest\";\n    TypeStrings[TypeStrings[\"IncomingResponse\"] = 8] = \"IncomingResponse\";\n    TypeStrings[TypeStrings[\"InvalidStateError\"] = 9] = \"InvalidStateError\";\n    TypeStrings[TypeStrings[\"InviteClientContext\"] = 10] = \"InviteClientContext\";\n    TypeStrings[TypeStrings[\"InviteClientTransaction\"] = 11] = \"InviteClientTransaction\";\n    TypeStrings[TypeStrings[\"InviteServerContext\"] = 12] = \"InviteServerContext\";\n    TypeStrings[TypeStrings[\"InviteServerTransaction\"] = 13] = \"InviteServerTransaction\";\n    TypeStrings[TypeStrings[\"Logger\"] = 14] = \"Logger\";\n    TypeStrings[TypeStrings[\"LoggerFactory\"] = 15] = \"LoggerFactory\";\n    TypeStrings[TypeStrings[\"MethodParameterError\"] = 16] = \"MethodParameterError\";\n    TypeStrings[TypeStrings[\"NameAddrHeader\"] = 17] = \"NameAddrHeader\";\n    TypeStrings[TypeStrings[\"NonInviteClientTransaction\"] = 18] = \"NonInviteClientTransaction\";\n    TypeStrings[TypeStrings[\"NonInviteServerTransaction\"] = 19] = \"NonInviteServerTransaction\";\n    TypeStrings[TypeStrings[\"NotSupportedError\"] = 20] = \"NotSupportedError\";\n    TypeStrings[TypeStrings[\"OutgoingRequest\"] = 21] = \"OutgoingRequest\";\n    TypeStrings[TypeStrings[\"Parameters\"] = 22] = \"Parameters\";\n    TypeStrings[TypeStrings[\"PublishContext\"] = 23] = \"PublishContext\";\n    TypeStrings[TypeStrings[\"ReferClientContext\"] = 24] = \"ReferClientContext\";\n    TypeStrings[TypeStrings[\"ReferServerContext\"] = 25] = \"ReferServerContext\";\n    TypeStrings[TypeStrings[\"RegisterContext\"] = 26] = \"RegisterContext\";\n    TypeStrings[TypeStrings[\"RenegotiationError\"] = 27] = \"RenegotiationError\";\n    TypeStrings[TypeStrings[\"RequestSender\"] = 28] = \"RequestSender\";\n    TypeStrings[TypeStrings[\"ServerContext\"] = 29] = \"ServerContext\";\n    TypeStrings[TypeStrings[\"Session\"] = 30] = \"Session\";\n    TypeStrings[TypeStrings[\"SessionDescriptionHandler\"] = 31] = \"SessionDescriptionHandler\";\n    TypeStrings[TypeStrings[\"SessionDescriptionHandlerError\"] = 32] = \"SessionDescriptionHandlerError\";\n    TypeStrings[TypeStrings[\"SessionDescriptionHandlerObserver\"] = 33] = \"SessionDescriptionHandlerObserver\";\n    TypeStrings[TypeStrings[\"Subscription\"] = 34] = \"Subscription\";\n    TypeStrings[TypeStrings[\"Transport\"] = 35] = \"Transport\";\n    TypeStrings[TypeStrings[\"TransportError\"] = 36] = \"TransportError\";\n    TypeStrings[TypeStrings[\"UA\"] = 37] = \"UA\";\n    TypeStrings[TypeStrings[\"URI\"] = 38] = \"URI\";\n})(TypeStrings = exports.TypeStrings || (exports.TypeStrings = {}));\n// UA status codes\nvar UAStatus;\n(function (UAStatus) {\n    UAStatus[UAStatus[\"STATUS_INIT\"] = 0] = \"STATUS_INIT\";\n    UAStatus[UAStatus[\"STATUS_STARTING\"] = 1] = \"STATUS_STARTING\";\n    UAStatus[UAStatus[\"STATUS_READY\"] = 2] = \"STATUS_READY\";\n    UAStatus[UAStatus[\"STATUS_USER_CLOSED\"] = 3] = \"STATUS_USER_CLOSED\";\n    UAStatus[UAStatus[\"STATUS_NOT_READY\"] = 4] = \"STATUS_NOT_READY\";\n})(UAStatus = exports.UAStatus || (exports.UAStatus = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Enums_1 = require(\"../Enums\");\n/* SessionDescriptionHandlerObserver\n * @class SessionDescriptionHandler Observer Class.\n * @param {SIP.Session} session\n * @param {Object} [options]\n */\nvar SessionDescriptionHandlerObserver = /** @class */ (function () {\n    function SessionDescriptionHandlerObserver(session, options) {\n        this.type = Enums_1.TypeStrings.SessionDescriptionHandlerObserver;\n        this.session = session;\n        this.options = options;\n    }\n    SessionDescriptionHandlerObserver.prototype.trackAdded = function () {\n        this.session.emit(\"trackAdded\");\n    };\n    SessionDescriptionHandlerObserver.prototype.directionChanged = function () {\n        this.session.emit(\"directionChanged\");\n    };\n    return SessionDescriptionHandlerObserver;\n}());\nexports.SessionDescriptionHandlerObserver = SessionDescriptionHandlerObserver;\n","import {patchUserAgent, WebPhoneUserAgent} from './userAgent';\nimport {UA, Web, SessionDescriptionHandlerModifiers} from 'sip.js';\nimport {uuidKey, defaultMediaConstraints} from './constants';\nimport {uuid, delay, extend} from './utils';\nimport {WebPhoneSession} from './session';\nimport {AudioHelperOptions} from './audioHelper';\nimport {default as MediaStreams, MediaStreamsImpl} from './mediaStreams';\nimport {DefaultSessionDescriptionHandler} from \"./DefaultSessionDescriptionHandler\";\nimport {Logger} from \"sip.js/types/logger-factory\";\nimport {SessionDescriptionHandlerObserver} from 'sip.js/lib/Web/SessionDescriptionHandlerObserver';\n\nconst {version} = require('../package.json');\n\nexport interface WebPhoneRegData {\n    sipInfo?: any;\n    sipFlags?: any;\n    sipErrorCodes?: string[];\n}\n\nexport interface WebPhoneOptions {\n    uuid?: string;\n    uuidKey?: string;\n    appKey?: string;\n    appName?: string;\n    appVersion?: string;\n    enableUnifiedSDP?: boolean;\n    enableMidLinesInSDP?: boolean;\n    enableQos?: boolean;\n    enableMediaReportLogging?: boolean;\n    onSession?: (session: WebPhoneSession) => any;\n    audioHelper?: AudioHelperOptions;\n    modifiers?: SessionDescriptionHandlerModifiers;\n    media?: any;\n    mediaConstraints?: any;\n    sessionDescriptionHandlerFactoryOptions?: any;\n    sessionDescriptionHandlerFactory?: any;\n    maxReconnectionAttempts?: number;\n    reconnectionTimeout?: number;\n    connectionTimeout?: number;\n    keepAliveDebounce?: number;\n    logLevel?: any; // import {Levels} from \"sip.js/types/logger-factory\";\n    builtinEnabled?: boolean;\n    connector?: any;\n    sipErrorCodes?: string[];\n    switchBackInterval?: number;\n    maxReconnectionAttemptsNoBackup?: number;\n    maxReconnectionAttemptsWithBackup?: number;\n    reconnectionTimeoutNoBackup?: number;\n    reconnectionTimeoutWithBackup?: number;\n    instanceId?: string;\n    regId?: number;\n    enableDefaultModifiers?: boolean;\n    enablePlanB?: boolean;\n    stunServers?: any;\n}\n\nexport default class WebPhone {\n    public static version = '0.8.1';\n    public static uuid = uuid;\n    public static delay = delay;\n    public static extend = extend;\n    public static MediaStreams = MediaStreams;\n    public static MediaStreamsImpl = MediaStreamsImpl;\n\n    public sipInfo: any;\n    public sipFlags: any;\n    public uuidKey: string;\n    public appKey: string;\n    public appName: string;\n    public appVersion: string;\n    public userAgent: WebPhoneUserAgent;\n\n    /**\n     * TODO: include 'WebPhone' for all apps other than Chrome and Glip\n     * TODO: parse wsservers from new api spec\n     */\n    public constructor(regData: WebPhoneRegData = {}, options: WebPhoneOptions = {}) {\n        this.sipInfo = regData.sipInfo[0] || regData.sipInfo;\n        this.sipFlags = regData.sipFlags;\n\n        this.uuidKey = options.uuidKey || uuidKey;\n\n        const id = options.uuid || localStorage.getItem(this.uuidKey) || uuid(); //TODO Make configurable\n        localStorage.setItem(this.uuidKey, id);\n\n        this.appKey = options.appKey;\n        this.appName = options.appName;\n        this.appVersion = options.appVersion;\n\n        const ua_match = navigator.userAgent.match(/\\((.*?)\\)/);\n        const app_client_os = (ua_match && ua_match.length && ua_match[1]).replace(/[^a-zA-Z0-9.:_]+/g, '-') || '';\n\n        const userAgentString =\n            (options.appName ? options.appName + (options.appVersion ? '/' + options.appVersion : '') + ' ' : '') +\n            (app_client_os ? app_client_os : '') +\n            ` RCWEBPHONE/${version}`;\n\n        const modifiers = options.modifiers || [];\n\n        if (options.enableDefaultModifiers !== false) {\n            modifiers.push(Web.Modifiers.stripG722);\n            modifiers.push(Web.Modifiers.stripTcpCandidates);\n        }\n\n        if (options.enableMidLinesInSDP) {\n            modifiers.push(Web.Modifiers.addMidLines);\n        }\n\n        var sdpSemantics = 'unified-plan';\n        if (options.enablePlanB) {\n            sdpSemantics = 'plan-b';\n        }\n\n        var stunServerArr = options.stunServers || this.sipInfo.stunServers || ['stun:74.125.194.127:19302'];\n\n        var iceServers = [];\n        stunServerArr.forEach(addr => {\n            addr = !/^(stun:)/.test(addr) ? 'stun:' + addr : addr;\n            iceServers.push({urls: addr});\n        });\n\n        const sessionDescriptionHandlerFactoryOptions = options.sessionDescriptionHandlerFactoryOptions || {\n            peerConnectionOptions: {\n                iceCheckingTimeout: this.sipInfo.iceCheckingTimeout || this.sipInfo.iceGatheringTimeout || 500,\n                rtcConfiguration: {\n                    sdpSemantics,\n                    iceServers\n                }\n            },\n            constraints: options.mediaConstraints || defaultMediaConstraints,\n            modifiers\n        };\n\n        const browserUa = navigator.userAgent.toLowerCase();\n        let isSafari = false;\n        let isFirefox = false;\n\n        if (browserUa.indexOf('safari') > -1 && browserUa.indexOf('chrome') < 0) {\n            isSafari = true;\n        } else if (browserUa.indexOf('firefox') > -1 && browserUa.indexOf('chrome') < 0) {\n            isFirefox = true;\n        }\n\n        if (isFirefox) {\n            sessionDescriptionHandlerFactoryOptions.alwaysAcquireMediaFirst = true;\n        }\n\n        const sessionDescriptionHandlerFactory = function(session, options) {\n            const logger: Logger = session.ua.getLogger(\"sip.invitecontext.defaultSessionDescriptionHandler\", session.id);\n            const observer: SessionDescriptionHandlerObserver = new SessionDescriptionHandlerObserver(session, options);\n            return new DefaultSessionDescriptionHandler(logger, observer, sessionDescriptionHandlerFactoryOptions);\n        };\n\n        const sipErrorCodes =\n            regData.sipErrorCodes && regData.sipErrorCodes.length\n                ? regData.sipErrorCodes\n                : ['408', '502', '503', '504'];\n\n        let wsServers = [];\n\n        if (this.sipInfo.outboundProxy && this.sipInfo.transport) {\n            wsServers.push({\n                wsUri: this.sipInfo.transport.toLowerCase() + '://' + this.sipInfo.outboundProxy,\n                weight: 10\n            });\n        }\n\n        if (this.sipInfo.outboundProxyBackup && this.sipInfo.transport) {\n            wsServers.push({\n                wsUri: this.sipInfo.transport.toLowerCase() + '://' + this.sipInfo.outboundProxyBackup,\n                weight: 0\n            });\n        }\n\n        wsServers = wsServers.length ? wsServers : this.sipInfo.wsServers;\n\n        const maxReconnectionAttemptsNoBackup = options.maxReconnectionAttemptsNoBackup || 15;\n        const maxReconnectionAttemptsWithBackup = options.maxReconnectionAttemptsWithBackup || 10;\n\n        const reconnectionTimeoutNoBackup = options.reconnectionTimeoutNoBackup || 5;\n        const reconnectionTimeoutWithBackup = options.reconnectionTimeoutWithBackup || 4;\n\n        const configuration = {\n            uri: `sip:${this.sipInfo.username}@${this.sipInfo.domain}`,\n\n            transportOptions: {\n                wsServers,\n                traceSip: true,\n                maxReconnectionAttempts:\n                    wsServers.length === 1 ? maxReconnectionAttemptsNoBackup : maxReconnectionAttemptsWithBackup, //Fallback parameters if no backup prxy specified\n                reconnectionTimeout:\n                    wsServers.length === 1 ? reconnectionTimeoutNoBackup : reconnectionTimeoutWithBackup, //Fallback parameters if no backup prxy specified\n                connectionTimeout: 5\n            },\n            authorizationUser: this.sipInfo.authorizationId,\n            password: this.sipInfo.password,\n            // turnServers: [],\n            log: {\n                level: options.logLevel || 1, //FIXME LOG LEVEL 3\n                builtinEnabled: typeof options.builtinEnabled === 'undefined' ? true : options.builtinEnabled,\n                connector: options.connector || null\n            },\n            domain: this.sipInfo.domain,\n            autostart: false,\n            register: true,\n            userAgentString,\n            sessionDescriptionHandlerFactoryOptions,\n            sessionDescriptionHandlerFactory,\n            allowLegacyNotifications: true,\n            registerOptions: {\n                instanceId: options.instanceId || undefined,\n                regId: options.regId || undefined\n            }\n        };\n\n        options.sipErrorCodes = sipErrorCodes;\n        options.switchBackInterval = this.sipInfo.switchBackInterval;\n\n        this.userAgent = patchUserAgent(new UA(configuration) as WebPhoneUserAgent, this.sipInfo, options, id);\n    }\n}\n","import {ClientContext, UA} from 'sip.js';\nimport {AudioHelper} from './audioHelper';\nimport {patchSession, patchIncomingSession, WebPhoneSession} from './session';\nimport {TransportConstructorWrapper, WebPhoneSIPTransport} from './sipTransportConstructor';\n\nexport interface WebPhoneUserAgent extends UA {\n    media: any;\n    defaultHeaders: any;\n    enableQos: boolean;\n    enableMediaReportLogging: boolean;\n    qosCollectInterval: number;\n    sipInfo: any;\n    audioHelper: AudioHelper;\n    onSession: (session: WebPhoneSession) => any;\n    createRcMessage: typeof createRcMessage;\n    sendMessage: typeof sendMessage;\n    __invite: typeof UA.prototype.invite;\n    __register: typeof UA.prototype.register;\n    __unregister: typeof UA.prototype.unregister;\n    __transportConstructor: any;\n    __onTransportConnected: () => void; // It is a private method\n    onTransportConnected: typeof onTransportConnected;\n    configuration: typeof UA.prototype.configuration;\n    transport: WebPhoneSIPTransport;\n}\n\nexport const patchUserAgent = (userAgent: WebPhoneUserAgent, sipInfo, options, id): WebPhoneUserAgent => {\n    userAgent.defaultHeaders = ['P-rc-endpoint-id: ' + id, 'Client-id:' + options.appKey];\n\n    userAgent.media = {};\n\n    userAgent.enableQos = options.enableQos;\n    userAgent.enableMediaReportLogging = options.enableMediaReportLogging;\n\n    userAgent.qosCollectInterval = options.qosCollectInterval || 5000;\n\n    if (options.media && (options.media.remote && options.media.local)) {\n        userAgent.media.remote = options.media.remote;\n        userAgent.media.local = options.media.local;\n    } else userAgent.media = null;\n\n    userAgent.sipInfo = sipInfo;\n\n    userAgent.__invite = userAgent.invite;\n    userAgent.invite = invite.bind(userAgent);\n\n    userAgent.__register = userAgent.register;\n    userAgent.register = register.bind(userAgent);\n\n    userAgent.__unregister = userAgent.unregister;\n    userAgent.unregister = unregister.bind(userAgent);\n\n    userAgent.audioHelper = new AudioHelper(options.audioHelper);\n\n    userAgent.__transportConstructor = userAgent.configuration.transportConstructor;\n    userAgent.configuration.transportConstructor = TransportConstructorWrapper(\n        userAgent.__transportConstructor,\n        options\n    );\n\n    userAgent.onSession = options.onSession || null;\n    userAgent.createRcMessage = createRcMessage;\n    userAgent.sendMessage = sendMessage;\n\n    userAgent.__onTransportConnected = userAgent.onTransportConnected;\n    userAgent.onTransportConnected = onTransportConnected.bind(userAgent);\n\n    userAgent.on('invite', (session: WebPhoneSession) => {\n        userAgent.audioHelper.playIncoming(true);\n        patchSession(session);\n        patchIncomingSession(session);\n        session.logger.log('UA recieved incoming call invite');\n        session._sendReceiveConfirmPromise = session\n            .sendReceiveConfirm()\n            .then(() => {\n                session.logger.log('sendReceiveConfirm success');\n            })\n            .catch(error => {\n                session.logger.error('failed to send receive confirmation via SIP MESSAGE due to ' + error);\n            });\n    });\n\n    userAgent.on('registrationFailed', (e: any) => {\n        // Check the status of message is in sipErrorCodes and disconnecting from server if it so;\n        if (!e) {\n            return;\n        }\n\n        const message = e.data || e;\n        if (message && typeof message === 'string' && userAgent.transport.isSipErrorCode(message)) {\n            userAgent.transport.onSipErrorCode();\n        }\n        userAgent.logger.warn('UA Registration Failed');\n    });\n\n    userAgent.on('notify', ({request}: any) => {\n        const event = request && request.headers && request.headers.Event && request.headers.Event[0];\n\n        if (event && event.raw === 'check-sync') {\n            userAgent.emit('provisionUpdate');\n        }\n        userAgent.logger.log('UA recieved notify');\n    });\n\n    userAgent.start();\n\n    return userAgent;\n};\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nfunction onTransportConnected(this: WebPhoneUserAgent): any {\n    if (this.configuration.register) {\n        return this.register();\n    }\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\nfunction createRcMessage(this: WebPhoneUserAgent, options: any): string {\n    options.body = options.body || '';\n    return (\n        '<Msg>' +\n        '<Hdr SID=\"' +\n        options.sid +\n        '\" Req=\"' +\n        options.request +\n        '\" From=\"' +\n        options.from +\n        '\" To=\"' +\n        options.to +\n        '\" Cmd=\"' +\n        options.reqid +\n        '\"/> ' +\n        '<Bdy Cln=\"' +\n        this.sipInfo.authorizationId +\n        '\" ' +\n        options.body +\n        '/>' +\n        '</Msg>'\n    );\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nfunction sendMessage(this: WebPhoneUserAgent, to: string, messageData: string): Promise<ClientContext> {\n    const userAgent: WebPhoneUserAgent = this;\n    const sipOptions: any = {};\n    sipOptions.contentType = 'x-rc/agent';\n    sipOptions.extraHeaders = [];\n    sipOptions.extraHeaders.push('P-rc-ws: ' + this.contact);\n\n    return new Promise((resolve, reject) => {\n        var message = userAgent.message(to, messageData, sipOptions);\n        message.once('accepted', (response, cause) => resolve(response));\n        message.once('failed', (response, cause) => reject(new Error(cause)));\n    });\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nfunction register(this: WebPhoneUserAgent, options: any = {}): WebPhoneUserAgent {\n    return this.__register.call(this, {\n        ...options,\n        extraHeaders: [...(options.extraHeaders || []), ...this.defaultHeaders]\n    });\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nfunction unregister(this: WebPhoneUserAgent, options: any = {}): WebPhoneUserAgent {\n    return this.__unregister.call(this, {\n        ...options,\n        extraHeaders: [...(options.extraHeaders || []), ...this.defaultHeaders]\n    });\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nexport interface InviteOptions {\n    fromNumber?: string;\n    homeCountryId?: string;\n    extraHeaders?: any;\n    RTCConstraints?: any;\n}\n\nfunction invite(this: WebPhoneUserAgent, number: string, options: InviteOptions = {}): WebPhoneSession {\n    options.extraHeaders = (options.extraHeaders || []).concat(this.defaultHeaders);\n    options.extraHeaders.push(\n        'P-Asserted-Identity: sip:' + (options.fromNumber || this.sipInfo.username) + '@' + this.sipInfo.domain //FIXME Phone Number\n    );\n\n    //FIXME Backend should know it already\n    if (options.homeCountryId) {\n        options.extraHeaders.push('P-rc-country-id: ' + options.homeCountryId);\n    }\n\n    options.RTCConstraints = options.RTCConstraints || {\n        optional: [{DtlsSrtpKeyAgreement: 'true'}]\n    };\n\n    this.audioHelper.playOutgoing(true);\n    this.logger.log('Invite to ' + number + ' created with playOutgoing set to true');\n    return patchSession(this.__invite(number, options) as any);\n}\n","export interface DomAudio extends HTMLAudioElement {\n    playPromise?: Promise<any>;\n}\n\nexport interface AudioHelperOptions {\n    enabled?: boolean;\n    incoming?: string;\n    outgoing?: string;\n}\n\nexport class AudioHelper {\n    private readonly _enabled: boolean;\n    private _incoming: string;\n    private _outgoing: string;\n    private _audio: {[key: string]: DomAudio};\n\n    public volume: number;\n\n    public constructor(options: AudioHelperOptions = {}) {\n        this._enabled = !!options.enabled;\n        this.loadAudio(options);\n    }\n\n    private _playSound(url, val, volume): AudioHelper {\n        if (!this._enabled || !url) return this;\n\n        if (!this._audio[url]) {\n            if (val) {\n                this._audio[url] = new Audio();\n                this._audio[url].src = url;\n                this._audio[url].loop = true;\n                this._audio[url].volume = volume;\n                this._audio[url].playPromise = this._audio[url].play();\n            }\n        } else {\n            if (val) {\n                this._audio[url].currentTime = 0;\n                this._audio[url].playPromise = this._audio[url].play();\n            } else {\n                var audio = this._audio[url];\n                if (audio.playPromise !== undefined) {\n                    audio.playPromise.then(function() {\n                        audio.pause();\n                    });\n                }\n            }\n        }\n\n        return this;\n    }\n\n    public loadAudio(options): void {\n        this._incoming = options.incoming;\n        this._outgoing = options.outgoing;\n        this._audio = {};\n    }\n\n    public setVolume(volume): void {\n        if (volume < 0) {\n            volume = 0;\n        }\n        if (volume > 1) {\n            volume = 1;\n        }\n        this.volume = volume;\n        for (var url in this._audio) {\n            if (this._audio.hasOwnProperty(url)) {\n                this._audio[url].volume = volume;\n            }\n        }\n    }\n\n    public playIncoming(val): AudioHelper {\n        return this._playSound(this._incoming, val, this.volume || 0.5);\n    }\n\n    public playOutgoing(val): AudioHelper {\n        return this._playSound(this._outgoing, val, this.volume || 1);\n    }\n}\n","import {\n    C,\n    ClientContext,\n    Exceptions,\n    IncomingResponse,\n    InviteClientContext,\n    InviteServerContext,\n    OutgoingRequest,\n    ReferClientContext,\n    Session\n} from 'sip.js';\nimport {responseTimeout, messages} from './constants';\nimport {startQosStatsCollection} from './qos';\nimport {WebPhoneUserAgent} from './userAgent';\nimport {delay, extend} from './utils';\nimport {MediaStreams} from './mediaStreams';\nimport {RTPReport, InboundRtpReport, OutboundRtpReport, RttReport, isNoAudio} from './rtpReport';\n\nexport interface RCHeaders {\n    sid?: string;\n    request?: string;\n    from?: string;\n    to?: string;\n    srvLvl?: string;\n    srvLvlExt?: string;\n    nm?: string;\n    toNm?: string;\n    callAttributes?: string;\n    srcIVRSiteName?: string;\n    queueName?: string;\n    queueExtPin?: string;\n    inDID?: string;\n    inDIDLabel?: string;\n    callerId?: string;\n    callerIdName?: string;\n    displayInfo?: string;\n    displayInfoSub?: string;\n}\n\nexport interface RTCPeerConnectionLegacy extends RTCPeerConnection {\n    getRemoteStreams: () => MediaStream[];\n    getLocalStreams: () => MediaStream[];\n}\n\nexport type WebPhoneSession = InviteClientContext &\n    InviteServerContext & {\n        __sendRequest: typeof InviteServerContext.prototype.sendRequest;\n        __receiveRequest: typeof InviteServerContext.prototype.receiveRequest;\n        __accept: typeof InviteServerContext.prototype.accept;\n        __hold: typeof InviteClientContext.prototype.hold;\n        __unhold: typeof InviteClientContext.prototype.unhold;\n        __dtmf: typeof InviteClientContext.prototype.dtmf;\n        __reinvite: typeof InviteClientContext.prototype.reinvite;\n        sendRequest: typeof sendRequest;\n        receiveRequest: typeof receiveRequest;\n        accept: typeof accept;\n        hold: typeof hold;\n        unhold: typeof unhold;\n        dtmf: typeof dtmf;\n        reinvite: typeof reinvite;\n        _sendReceiveConfirmPromise: Promise<any>;\n        ua: WebPhoneUserAgent;\n        local_hold: boolean;\n        failed: any; //FIXME PROTECTED\n        sessionDescriptionHandler: {\n            peerConnection: RTCPeerConnectionLegacy; //FIXME Not documented\n            getDirection;\n        };\n        // non-sip\n        __patched: boolean;\n        __onRecord: boolean;\n        hasAnswer: boolean;\n        media: any;\n        rcHeaders: RCHeaders;\n        warmTransfer: typeof warmTransfer;\n        blindTransfer: typeof blindTransfer;\n        transfer: typeof transfer;\n        park: typeof park;\n        forward: typeof forward;\n        startRecord: typeof startRecord;\n        stopRecord: typeof stopRecord;\n        flip: typeof flip;\n        mute: typeof mute;\n        unmute: typeof unmute;\n        onLocalHold: typeof onLocalHold;\n        addTrack: typeof addTrack;\n        canUseRCMCallControl: typeof canUseRCMCallControl;\n        createSessionMessage: typeof createSessionMessage;\n        sendSessionMessage: typeof sendSessionMessage;\n        sendReceiveConfirm: typeof sendReceiveConfirm;\n        ignore: typeof ignore;\n        toVoicemail: typeof toVoicemail;\n        replyWithMessage: typeof replyWithMessage;\n        logger: any;\n        on(event: 'muted' | 'unmuted', listener: (session: WebPhoneSession) => void): WebPhoneSession;\n        mediaStreams: MediaStreams;\n        mediaStatsStarted: boolean;\n        noAudioReportCount: number;\n        reinviteForNoAudioSent: boolean;\n        stopMediaStats: typeof stopMediaStats;\n        receiveReinviteResponse: any;\n        pendingReinvite: boolean;\n        sendReinvite: Promise<any>;\n        _sendReinvite: typeof sendReinvite;\n        getIncomingInfoContent: typeof getIncomingInfoContent;\n        sendMoveResponse: typeof sendMoveResponse;\n    };\n\nexport const patchSession = (session: WebPhoneSession): WebPhoneSession => {\n    if (session.__patched) return session;\n\n    session.__patched = true;\n\n    session.__sendRequest = session.sendRequest;\n    session.__receiveRequest = session.receiveRequest;\n    session.__accept = (session as InviteServerContext).accept;\n    session.__hold = session.hold;\n    session.__unhold = session.unhold;\n    session.__dtmf = session.dtmf;\n    session.__reinvite = session.reinvite;\n\n    session.sendRequest = sendRequest.bind(session);\n    session.receiveRequest = receiveRequest.bind(session);\n    session.accept = accept.bind(session);\n    session.hold = hold.bind(session);\n    session.unhold = unhold.bind(session);\n    session.dtmf = dtmf.bind(session);\n    session.reinvite = reinvite.bind(session);\n\n    session.warmTransfer = warmTransfer.bind(session);\n    session.blindTransfer = blindTransfer.bind(session);\n    session.transfer = transfer.bind(session);\n    session.park = park.bind(session);\n    session.forward = forward.bind(session);\n    session.startRecord = startRecord.bind(session);\n    session.stopRecord = stopRecord.bind(session);\n    session.flip = flip.bind(session);\n\n    session.mute = mute.bind(session);\n    session.unmute = unmute.bind(session);\n    session.onLocalHold = onLocalHold.bind(session);\n\n    session.media = session.ua.media; //TODO Remove\n    session.addTrack = addTrack.bind(session);\n    session.stopMediaStats = stopMediaStats.bind(session);\n    session.getIncomingInfoContent = getIncomingInfoContent.bind(session);\n    session.sendMoveResponse = sendMoveResponse.bind(session);\n\n    session._sendReinvite = sendReinvite.bind(session);\n\n    session.on('replaced', patchSession);\n\n    // Audio\n    session.on('progress' as any, (incomingResponse: IncomingResponse) => {\n        stopPlaying();\n        if (incomingResponse.statusCode === 183) {\n            session.logger.log('Receiving 183 In Progress from server');\n            session.createDialog(incomingResponse, 'UAC');\n            session.hasAnswer = true;\n            session.status = Session.C.STATUS_EARLY_MEDIA;\n            session.logger.log('Created UAC Dialog');\n            session.sessionDescriptionHandler.setDescription(incomingResponse.body).catch(exception => {\n                session.logger.warn(exception);\n                session.failed(incomingResponse, C.causes.BAD_MEDIA_DESCRIPTION);\n                session.terminate({\n                    status_code: 488,\n                    reason_phrase: 'Bad Media Description'\n                });\n                session.logger.log('Call failed with Bad Media Description');\n            });\n        }\n    });\n\n    if (session.media) session.on('trackAdded', addTrack as any);\n\n    const stopPlaying = (): void => {\n        session.ua.audioHelper.playOutgoing(false);\n        session.ua.audioHelper.playIncoming(false);\n        session.removeListener('accepted', stopPlaying);\n        session.removeListener('rejected', stopPlaying);\n        session.removeListener('bye', stopPlaying);\n        session.removeListener('terminated', stopPlaying);\n        session.removeListener('cancel', stopPlaying);\n        session.removeListener('failed', stopPlaying);\n        session.removeListener('replaced', stopPlaying);\n    };\n\n    session.on('accepted', stopPlaying);\n    session.on('rejected', stopPlaying);\n    session.on('bye', stopPlaying);\n    session.on('terminated', stopPlaying);\n    session.on('cancel', stopPlaying);\n    session.on('failed', stopPlaying);\n    session.on('replaced', stopPlaying);\n\n    if (session.ua.enableQos) {\n        session.on('SessionDescriptionHandler-created', () => {\n            session.logger.log('SessionDescriptionHandler Created');\n            startQosStatsCollection(session);\n            navigator.mediaDevices.enumerateDevices().then(function(devices) {\n                devices.forEach(function(device) {\n                    session.logger.log(device.kind + ' = ' + device.label + JSON.stringify(device));\n                });\n            });\n        });\n    }\n\n    if (session.ua.onSession) session.ua.onSession(session);\n\n    session.mediaStatsStarted = false;\n    session.noAudioReportCount = 0;\n    session.reinviteForNoAudioSent = false;\n\n    return session;\n};\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nexport const patchIncomingSession = (session: WebPhoneSession): void => {\n    try {\n        parseRcHeader(session);\n    } catch (e) {\n        session.logger.error(\"Can't parse RC headers from invite request due to \" + e);\n    }\n    session.canUseRCMCallControl = canUseRCMCallControl;\n    session.createSessionMessage = createSessionMessage;\n    session.sendSessionMessage = sendSessionMessage;\n    session.sendReceiveConfirm = sendReceiveConfirm;\n    session.ignore = ignore;\n    session.toVoicemail = toVoicemail;\n    session.replyWithMessage = replyWithMessage;\n};\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nconst parseRcHeaderString = (str = ''): any => {\n    const obj = {};\n    const pairs = str.split(/; */);\n\n    pairs.forEach(pair => {\n        let eq_idx = pair.indexOf('=');\n\n        // skip things that don't look like key=value\n        if (eq_idx < 0) {\n            return;\n        }\n\n        const key = pair.substr(0, eq_idx).trim();\n        const val = pair.substr(++eq_idx, pair.length).trim();\n\n        // only assign once\n        if (undefined === obj[key]) {\n            obj[key] = val;\n        }\n    });\n\n    return obj;\n};\n\nconst parseRcHeader = (session: WebPhoneSession): any => {\n    const prc = session.request.headers['P-Rc'];\n    const prcCallInfo = session.request.headers['P-Rc-Api-Call-Info'];\n    if (prc && prc.length) {\n        const rawInviteMsg = prc[0].raw;\n        const parser = new DOMParser();\n        const xmlDoc = parser.parseFromString(rawInviteMsg, 'text/xml');\n        const hdrNode = xmlDoc.getElementsByTagName('Hdr')[0];\n        const bdyNode = xmlDoc.getElementsByTagName('Bdy')[0];\n\n        if (hdrNode) {\n            session.rcHeaders = {\n                sid: hdrNode.getAttribute('SID'),\n                request: hdrNode.getAttribute('Req'),\n                from: hdrNode.getAttribute('From'),\n                to: hdrNode.getAttribute('To')\n            };\n        }\n        if (bdyNode) {\n            extend(session.rcHeaders, {\n                srvLvl: bdyNode.getAttribute('SrvLvl'),\n                srvLvlExt: bdyNode.getAttribute('SrvLvlExt'),\n                nm: bdyNode.getAttribute('Nm'),\n                toNm: bdyNode.getAttribute('ToNm')\n            });\n        }\n    }\n    if (prcCallInfo && prcCallInfo.length) {\n        const rawCallInfo = prcCallInfo[0].raw;\n\n        if (rawCallInfo) {\n            const parsed = parseRcHeaderString(rawCallInfo);\n            extend(session.rcHeaders, parsed);\n        }\n    }\n};\n\nconst mediaCheckTimer = 2000;\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nfunction canUseRCMCallControl(this: WebPhoneSession): boolean {\n    return !!this.rcHeaders;\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nfunction createSessionMessage(this: WebPhoneSession, options: RCHeaders): string {\n    if (!this.rcHeaders) {\n        return undefined;\n    }\n    extend(options, {\n        sid: this.rcHeaders.sid,\n        request: this.rcHeaders.request,\n        from: this.rcHeaders.to,\n        to: this.rcHeaders.from\n    });\n    return this.ua.createRcMessage(options);\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nasync function ignore(this: WebPhoneSession): Promise<ClientContext> {\n    return this._sendReceiveConfirmPromise.then(() => {\n        return this.sendSessionMessage(messages.ignore);\n    });\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nasync function sendSessionMessage(this: WebPhoneSession, options): Promise<ClientContext> {\n    if (!this.rcHeaders) {\n        throw new Error(\"Can't send SIP MESSAGE related to session: no RC headers available\");\n    }\n    return this.ua.sendMessage(this.rcHeaders.from, this.createSessionMessage(options));\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nasync function sendReceiveConfirm(this: WebPhoneSession): Promise<ClientContext> {\n    return this.sendSessionMessage(messages.receiveConfirm);\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nasync function toVoicemail(this: WebPhoneSession): Promise<ClientContext> {\n    return this._sendReceiveConfirmPromise.then(() => {\n        return this.sendSessionMessage(messages.toVoicemail);\n    });\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\ninterface ReplyOptions {\n    replyType: number; //TODO Use enum\n    replyText: string;\n    timeValue: string;\n    timeUnits: string;\n    callbackDirection: string;\n}\n\nasync function replyWithMessage(this: WebPhoneSession, replyOptions: ReplyOptions): Promise<ClientContext> {\n    let body = 'RepTp=\"' + replyOptions.replyType + '\"';\n\n    if (replyOptions.replyType === 0) {\n        body += ' Bdy=\"' + replyOptions.replyText + '\"';\n    } else if (replyOptions.replyType === 1 || replyOptions.replyType === 4) {\n        body += ' Vl=\"' + replyOptions.timeValue + '\"';\n        body += ' Units=\"' + replyOptions.timeUnits + '\"';\n        body += ' Dir=\"' + replyOptions.callbackDirection + '\"';\n    }\n    return this._sendReceiveConfirmPromise.then(() => {\n        return this.sendSessionMessage({\n            reqid: messages.replyWithMessage.reqid,\n            body\n        });\n    });\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nasync function sendReceive(session: WebPhoneSession, command: any, options?: any): Promise<any> {\n    options = options || {};\n\n    extend(command, options);\n\n    let cseq;\n\n    return new Promise((resolve, reject) => {\n        const extraHeaders = (options.extraHeaders || [])\n            .concat(session.ua.defaultHeaders)\n            .concat(['Content-Type: application/json;charset=utf-8']);\n\n        session.sendRequest(C.INFO, {\n            body: JSON.stringify({\n                request: command\n            }),\n            extraHeaders,\n            receiveResponse: (response: IncomingResponse) => {\n                let timeout = null;\n                if (response.statusCode === 200) {\n                    cseq = response.cseq;\n                    const onInfo = (request: OutgoingRequest): void => {\n                        if (response.cseq !== cseq) return;\n                        const body = (request && request.body) || '{}';\n                        let obj;\n\n                        try {\n                            obj = JSON.parse(body);\n                        } catch (e) {\n                            obj = {};\n                        }\n\n                        if (obj.response && obj.response.command === command.command) {\n                            if (obj.response.result) {\n                                if (obj.response.result.code.toString() === '0') {\n                                    return resolve(obj.response.result);\n                                }\n                                return reject(obj.response.result);\n                            }\n                        }\n                        timeout && clearTimeout(timeout);\n                        session.removeListener('RC_SIP_INFO', onInfo);\n                        resolve(null); //FIXME What to resolve\n                    };\n                    timeout = setTimeout(() => {\n                        reject(new Error('Timeout: no reply'));\n                        session.removeListener('RC_SIP_INFO', onInfo);\n                    }, responseTimeout);\n                    session.on('RC_SIP_INFO' as any, onInfo);\n                } else {\n                    reject(\n                        new Error('The INFO response status code is: ' + response.statusCode + ' (waiting for 200)')\n                    );\n                }\n            }\n        });\n    });\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nfunction sendRequest(this: WebPhoneSession, type, config): InviteServerContext {\n    if (type === C.PRACK) {\n        // type = C.ACK;\n        return this;\n    }\n    return this.__sendRequest(type, config);\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nasync function setRecord(session: WebPhoneSession, flag: boolean): Promise<any> {\n    const message = !!flag ? messages.startRecord : messages.stopRecord;\n\n    if ((session.__onRecord && !flag) || (!session.__onRecord && flag)) {\n        const data = await sendReceive(session, message);\n        session.__onRecord = !!flag;\n        return data;\n    }\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n//TODO: Convert to toggleHold() and deprecate this function\nasync function setLocalHold(session: WebPhoneSession, flag: boolean): Promise<any> {\n    if (flag) {\n        await session.__hold();\n    } else {\n        await session.__unhold();\n    }\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\nfunction getIncomingInfoContent(this: WebPhoneSession, request): any {\n    if (!request || !request.body) {\n        return {};\n    }\n    let ret = {};\n    try {\n        ret = JSON.parse(request.body);\n    } catch (e) {\n        return {}\n    }\n    return ret;\n}\n\nfunction sendMoveResponse(this: WebPhoneSession,\n                          reqId: number,\n                          code: number,\n                          description: string,\n                          options: any = {}) {\n    const extraHeaders = [...(options.extraHeaders || []),\n                          ...this.ua.defaultHeaders,\n                          'Content-Type: application/json;charset=utf-8'];\n    this.sendRequest(C.INFO, {\n        body: JSON.stringify(\n            {response: {\n                reqId,\n                command: 'move',\n                result: {\n                    code,\n                    description\n                }\n            }\n        }),\n        extraHeaders});\n}\n\nfunction receiveRequest(this: WebPhoneSession, request): any {\n    switch (request.method) {\n        case C.INFO:\n            // For the Move2RCV request from server\n            const content = this.getIncomingInfoContent(request);\n            if (content?.request?.reqId\n                && content?.request?.command === 'move'\n                && content?.request?.target === 'rcv') {\n                    request.reply(200);\n                    this.emit('moveToRcv', content.request);\n                    return this;\n            }\n            // For other SIP INFO from server\n            this.emit('RC_SIP_INFO', request);\n            // SIP.js does not support application/json content type, so we monkey override its behaviour in this case\n            if (this.status === Session.C.STATUS_CONFIRMED || this.status === Session.C.STATUS_WAITING_FOR_ACK) {\n                const contentType = request.getHeader('content-type');\n                if (contentType.match(/^application\\/json/i)) {\n                    request.reply(200);\n                    return this;\n                }\n            }\n            break;\n    }\n    return this.__receiveRequest.apply(this, arguments);\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nfunction accept(this: WebPhoneSession, options: any = {}): Promise<WebPhoneSession> {\n    options = options || {};\n    options.extraHeaders = (options.extraHeaders || []).concat(this.ua.defaultHeaders);\n    options.RTCConstraints = options.RTCConstraints || {\n        optional: [{DtlsSrtpKeyAgreement: 'true'}]\n    };\n\n    return new Promise((resolve, reject) => {\n        const onAnswered = (): void => {\n            resolve(this);\n            this.removeListener('failed', onFail);\n        };\n\n        const onFail = (e): void => {\n            reject(e);\n            this.removeListener('accepted', onAnswered);\n        };\n\n        //TODO More events?\n        this.once('accepted', onAnswered);\n        this.once('failed', onFail);\n        this.__accept(options);\n    });\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nfunction dtmf(this: WebPhoneSession, dtmf: string, duration = 100, interToneGap = 50): void {\n    duration = parseInt(duration.toString());\n    interToneGap = parseInt(interToneGap.toString());\n    const pc = this.sessionDescriptionHandler.peerConnection;\n    const senders = pc.getSenders();\n    const audioSender = senders.find(sender => {\n        return sender.track && sender.track.kind === 'audio';\n    });\n    const dtmfSender = audioSender.dtmf;\n    if (dtmfSender !== undefined && dtmfSender) {\n        this.logger.log(`Send DTMF: ${dtmf} Duration: ${duration} InterToneGap: ${interToneGap}`);\n        return dtmfSender.insertDTMF(dtmf, duration, interToneGap);\n    }\n    const sender = dtmfSender && !dtmfSender.canInsertDTMF ? \"can't insert DTMF\" : 'Unknown';\n    throw new Error('Send DTMF failed: ' + (!dtmfSender ? 'no sender' : sender));\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nasync function sendReinvite(this: WebPhoneSession, options: any = {}): Promise<any> {\n    if (this.pendingReinvite) {\n        throw new Error('Reinvite in progress. Please wait until complete, then try again.');\n    }\n    if (!this.sessionDescriptionHandler) {\n        throw new Error(\"No SessionDescriptionHandler, can't send reinvite..\");\n    }\n    this.pendingReinvite = true;\n    options.modifiers = options.modifiers || [];\n\n    try {\n        const description = await this.sessionDescriptionHandler.getDescription(\n            options.sessionDescriptionHandlerOptions,\n            options.modifiers\n        );\n        const result = await new Promise((resolve, reject) => {\n            this.sendRequest(C.INVITE, {\n                body: description,\n                receiveResponse: (response: IncomingResponse) => {\n                    if (response.statusCode === 200) resolve(response);\n                }\n            });\n        });\n        await this.receiveReinviteResponse(result);\n        return result;\n    } catch (e) {\n        this.pendingReinvite = false;\n        throw new Error('Reinvite Failed with the reason ' + e.message);\n    }\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nasync function hold(this: WebPhoneSession): Promise<any> {\n    if (this.status !== Session.C.STATUS_WAITING_FOR_ACK && this.status !== Session.C.STATUS_CONFIRMED) {\n        throw new Exceptions.InvalidStateError(this.status);\n    }\n    if (this.localHold) {\n        throw new Error('Session already on hold');\n    }\n    this.stopMediaStats();\n    const options = {\n        modifiers: []\n    };\n    options.modifiers.push(this.sessionDescriptionHandler.holdModifier);\n    try {\n        this.logger.log('Hold Initiated');\n        var response = await this._sendReinvite(options);\n        this.localHold = (response.statusCode === 200 && (this.sessionDescriptionHandler.getDirection() === 'sendonly'));\n        this.logger.log('Hold completed, localhold is set to ' + this.localHold);\n    } catch (e) {\n        throw new Error('Hold could not be completed');\n    }\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nasync function unhold(this: WebPhoneSession): Promise<any> {\n    if (this.status !== Session.C.STATUS_WAITING_FOR_ACK && this.status !== Session.C.STATUS_CONFIRMED) {\n        throw new Exceptions.InvalidStateError(this.status);\n    }\n    if (!this.localHold) {\n        throw new Error('Session not on hold, cannot unhold');\n    }\n    try {\n        this.logger.log('Unhold Initiated');\n        const response = await this._sendReinvite();\n        this.localHold = response.statusCode === 200 && this.sessionDescriptionHandler.getDirection() === 'sendonly';\n        this.logger.log('Unhold completed, localhold is set to ' + this.localHold);\n    } catch (e) {\n        throw new Error('Unhold could not be completed');\n    }\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nfunction blindTransfer(this: WebPhoneSession, target, options = {}): Promise<ReferClientContext> {\n    this.logger.log('Call transfer initiated');\n    return Promise.resolve(this.refer(target, options));\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nasync function warmTransfer(\n    this: WebPhoneSession,\n    target: WebPhoneSession,\n    transferOptions: any = {}\n): Promise<ReferClientContext> {\n    await (this.localHold ? Promise.resolve(null) : this.hold());\n    transferOptions.extraHeaders = (transferOptions.extraHeaders || []).concat(this.ua.defaultHeaders);\n    this.logger.log('Completing warm transfer');\n    return Promise.resolve(this.refer(target, transferOptions));\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nasync function transfer(\n    this: WebPhoneSession,\n    target: WebPhoneSession,\n    options: any = {}\n): Promise<ReferClientContext> {\n    options.extraHeaders = (options.extraHeaders || []).concat(this.ua.defaultHeaders);\n    return this.blindTransfer(target, options);\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nasync function forward(\n    this: WebPhoneSession,\n    target: WebPhoneSession,\n    acceptOptions,\n    transferOptions\n): Promise<ReferClientContext> {\n    let interval = null;\n    await this.accept(acceptOptions);\n    return new Promise(resolve => {\n        interval = setInterval(() => {\n            if (this.status === Session.C.STATUS_CONFIRMED) {\n                clearInterval(interval);\n                this.mute();\n                setTimeout(() => {\n                    resolve(this.transfer(target, transferOptions));\n                }, 700);\n            }\n        }, 50);\n    });\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nasync function startRecord(this: WebPhoneSession): Promise<any> {\n    return setRecord(this, true);\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nasync function stopRecord(this: WebPhoneSession): Promise<any> {\n    return setRecord(this, false);\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nasync function flip(this: WebPhoneSession, target): Promise<any> {\n    return sendReceive(this, messages.flip, {target});\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nfunction park(this: WebPhoneSession): Promise<any> {\n    return sendReceive(this, messages.park);\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nfunction reinvite(this: WebPhoneSession, options: any = {}, modifier = null): void {\n    options.sessionDescriptionHandlerOptions = options.sessionDescriptionHandlerOptions || {};\n    return this.__reinvite(options, modifier);\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nfunction toggleMute(session: WebPhoneSession, mute: boolean): void {\n    const pc = session.sessionDescriptionHandler.peerConnection;\n    if (pc.getSenders) {\n        pc.getSenders().forEach(sender => {\n            if (sender.track) {\n                sender.track.enabled = !mute;\n            }\n        });\n    }\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\nfunction mute(this: WebPhoneSession, silent?: boolean): void {\n    if (this.status !== Session.C.STATUS_CONFIRMED) {\n        this.logger.warn('An active call is required to mute audio');\n        return;\n    }\n    this.logger.log('Muting Audio');\n    if (!silent) {\n        this.emit('muted', this);\n    }\n    return toggleMute(this, true);\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nfunction unmute(this: WebPhoneSession, silent?: boolean): void {\n    if (this.status !== Session.C.STATUS_CONFIRMED) {\n        this.logger.warn('An active call is required to unmute audio');\n        return;\n    }\n    this.logger.log('Unmuting Audio');\n    if (!silent) {\n        this.emit('unmuted', this);\n    }\n    return toggleMute(this, false);\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nfunction onLocalHold(this: WebPhoneSession): boolean {\n    return this.localHold;\n}\n\n/*--------------------------------------------------------------------------------------------------------------------*/\n\nfunction addTrack(this: WebPhoneSession, remoteAudioEle, localAudioEle): void {\n    const pc = this.sessionDescriptionHandler.peerConnection;\n    let remoteAudio;\n    let localAudio;\n\n    if (remoteAudioEle && localAudioEle) {\n        remoteAudio = remoteAudioEle;\n        localAudio = localAudioEle;\n    } else if (this.media) {\n        remoteAudio = this.media.remote;\n        localAudio = this.media.local;\n    } else {\n        throw new Error('HTML Media Element not Defined');\n    }\n\n    let remoteStream = new MediaStream();\n    if (pc.getReceivers) {\n        pc.getReceivers().forEach(receiver => {\n            const rtrack = receiver.track;\n            if (rtrack) {\n                remoteStream.addTrack(rtrack);\n                this.logger.log('Remote track added');\n            }\n        });\n    } else {\n        remoteStream = pc.getRemoteStreams()[0];\n        this.logger.log('Remote track added');\n    }\n    remoteAudio.srcObject = remoteStream;\n    remoteAudio.play().catch(() => {\n        this.logger.log('Remote play was rejected');\n    });\n\n    let localStream = new MediaStream();\n    if (pc.getSenders) {\n        pc.getSenders().forEach(sender => {\n            const strack = sender.track;\n            if (strack && strack.kind === 'audio') {\n                localStream.addTrack(strack);\n                this.logger.log('Local track added');\n            }\n        });\n    } else {\n        localStream = pc.getLocalStreams()[0];\n        this.logger.log('Local track added');\n    }\n    localAudio.srcObject = localStream;\n    localAudio.play().catch(() => {\n        this.logger.log('Local play was rejected');\n    });\n    if (localStream && remoteStream && !this.mediaStatsStarted) {\n        this.mediaStreams = new MediaStreams(this);\n        this.logger.log('Start gathering media report');\n        this.mediaStatsStarted = true;\n        this.mediaStreams.getMediaStats((report: RTPReport) => {\n            if (this.ua.enableMediaReportLogging) {\n                this.logger.log(`Got media report: ${JSON.stringify(report)}`);\n            }\n            if (!this.reinviteForNoAudioSent && isNoAudio(report)) {\n                this.logger.log('No audio report');\n                this.noAudioReportCount++;\n                if (this.noAudioReportCount === 3) {\n                    this.logger.log('No audio for 6 sec. Trying to recover audio by sending Re-invite');\n                    this.mediaStreams.reconnectMedia();\n                    this.reinviteForNoAudioSent = true;\n                    this.noAudioReportCount = 0;\n                }\n            } else if (!isNoAudio(report)) {\n                this.noAudioReportCount = 0;\n            }\n        }, mediaCheckTimer);\n    }\n}\n\nfunction stopMediaStats(this: WebPhoneSession) {\n    this.logger.log('Stopping media stats collection');\n    if (!this) {\n        return;\n    }\n    this.mediaStreams && this.mediaStreams.stopMediaStats();\n    this.mediaStatsStarted = false;\n    this.noAudioReportCount = 0;\n}\n","import getStats from 'getstats';\nimport {WebPhoneSession} from './session';\n\nconst formatFloat = (input: any): string => parseFloat(input.toString()).toFixed(2);\n\nexport const startQosStatsCollection = (session: WebPhoneSession): void => {\n    const qosStatsObj = getQoSStatsTemplate();\n\n    qosStatsObj.callID = session.request.callId || '';\n    qosStatsObj.fromTag = session.request.fromTag || '';\n    qosStatsObj.toTag = session.request.toTag || '';\n    qosStatsObj.localID = session.request.headers.From[0].raw || session.request.headers.From[0];\n    qosStatsObj.remoteID = session.request.headers.To[0].raw || session.request.headers.To[0];\n    qosStatsObj.origID = session.request.headers.From[0].raw || session.request.headers.From[0];\n\n    let previousGetStatsResult;\n\n    if (!getStats) throw new Error('getStats module was not provided!');\n\n    getStats(\n        session.sessionDescriptionHandler.peerConnection,\n        function(getStatsResult) {\n            previousGetStatsResult = getStatsResult;\n            qosStatsObj.status = true;\n            var network = getNetworkType(previousGetStatsResult.connectionType);\n            qosStatsObj.localAddr = previousGetStatsResult.connectionType.local.ipAddress[0];\n            qosStatsObj.remoteAddr = previousGetStatsResult.connectionType.remote.ipAddress[0];\n            previousGetStatsResult.results.forEach(function(item) {\n                if (item.type === 'localcandidate') {\n                    qosStatsObj.localcandidate = item;\n                }\n                if (item.type === 'remotecandidate') {\n                    qosStatsObj.remotecandidate = item;\n                }\n                if (item.type === 'ssrc' && item.id.includes('send') && session.ua.enableMediaReportLogging) {\n                    if (parseInt(item.audioInputLevel, 10) === 0) {\n                        session.logger.log(\n                            'AudioInputLevel is 0. The local track might be muted or could have potential one-way audio issue. Check Microphone Volume settings.'\n                        );\n                        session.emit('no-input-volume');\n                    }\n                }\n                if (item.type === 'ssrc' && item.id.includes('recv')) {\n                    qosStatsObj.jitterBufferDiscardRate = item.googSecondaryDiscardedRate || 0;\n                    qosStatsObj.packetLost = item.packetsLost;\n                    qosStatsObj.packetsReceived = item.packetsReceived;\n                    qosStatsObj.totalSumJitter += parseFloat(item.googJitterBufferMs);\n                    qosStatsObj.totalIntervalCount += 1;\n                    qosStatsObj.JBM = Math.max(qosStatsObj.JBM, parseFloat(item.googJitterBufferMs));\n                    qosStatsObj.netType = addToMap(qosStatsObj.netType, network);\n                    if (session.ua.enableMediaReportLogging) {\n                        if (parseInt(item.audioOutputLevel, 10) <= 1) {\n                            session.logger.log(\n                                'Remote audioOutput level is 1. The remote track might be muted or could have potential one-way audio issue'\n                            );\n                            session.emit('no-output-volume');\n                        }\n                    }\n                }\n            });\n        },\n        session.ua.qosCollectInterval\n    );\n\n    session.on('terminated', function() {\n        previousGetStatsResult && previousGetStatsResult.nomore();\n        session.logger.log('Release media streams');\n        session.mediaStreams && session.mediaStreams.release();\n        publishQosStats(session, qosStatsObj);\n    });\n};\n\nconst publishQosStats = (session: WebPhoneSession, qosStatsObj: QosStats, options: any = {}): void => {\n    options = options || {};\n\n    const effectiveType = navigator['connection'].effectiveType || '';\n    const networkType = calculateNetworkUsage(qosStatsObj) || '';\n    const targetUrl = options.targetUrl || 'rtcpxr@rtcpxr.ringcentral.com:5060';\n    const event = options.event || 'vq-rtcpxr';\n    options.expires = 60;\n    options.contentType = 'application/vq-rtcpxr';\n    options.extraHeaders = (options.extraHeaders || []).concat(session.ua.defaultHeaders);\n    options.extraHeaders.push(\n        'p-rc-client-info:' + 'cpuRC=0:0;cpuOS=0:0;netType=' + networkType + ';ram=0:0;effectiveType=' + effectiveType\n    );\n\n    const calculatedStatsObj = calculateStats(qosStatsObj);\n    const body = createPublishBody(calculatedStatsObj);\n    const pub = session.ua.publish(targetUrl, event, body, options);\n    session.logger.log('Local Candidate: ' + JSON.stringify(qosStatsObj.localcandidate));\n    session.logger.log('Remote Candidate: ' + JSON.stringify(qosStatsObj.remotecandidate));\n\n    qosStatsObj.status = false;\n    pub.close();\n    session.emit('qos-published', body);\n};\n\nconst calculateNetworkUsage = (qosStatsObj: QosStats): string => {\n    const networkType = [];\n    for (const [key, value] of Object.entries(qosStatsObj.netType)) {\n        networkType.push(key + ':' + formatFloat(((value as any) * 100) / qosStatsObj.totalIntervalCount));\n    }\n    return networkType.join();\n};\n\nconst calculateStats = (qosStatsObj: QosStats): QosStats => {\n    const rawNLR = (qosStatsObj.packetLost * 100) / (qosStatsObj.packetsReceived + qosStatsObj.packetLost) || 0;\n    const rawJBN = qosStatsObj.totalIntervalCount > 0 ? qosStatsObj.totalSumJitter / qosStatsObj.totalIntervalCount : 0;\n\n    return {\n        ...qosStatsObj,\n        NLR: formatFloat(rawNLR),\n        JBN: formatFloat(rawJBN), //JitterBufferNominal\n        JDR: formatFloat(qosStatsObj.jitterBufferDiscardRate), //JitterBufferDiscardRate\n        MOSLQ: 0 //MOS Score\n    };\n};\n\nconst createPublishBody = (calculatedStatsObj: QosStats): string => {\n    const NLR = calculatedStatsObj.NLR || 0;\n    const JBM = calculatedStatsObj.JBM || 0;\n    const JBN = calculatedStatsObj.JBN || 0;\n    const JDR = calculatedStatsObj.JDR || 0;\n    const MOSLQ = calculatedStatsObj.MOSLQ || 0;\n\n    const callID = calculatedStatsObj.callID || '';\n    const fromTag = calculatedStatsObj.fromTag || '';\n    const toTag = calculatedStatsObj.toTag || '';\n    const localId = calculatedStatsObj.localID || '';\n    const remoteId = calculatedStatsObj.remoteID || '';\n\n    const localAddr = calculatedStatsObj.localAddr || '';\n    const remoteAddr = calculatedStatsObj.remoteAddr || '';\n\n    return (\n        `VQSessionReport: CallTerm\\r\\n` +\n        `CallID: ${callID}\\r\\n` +\n        `LocalID: ${localId}\\r\\n` +\n        `RemoteID: ${remoteId}\\r\\n` +\n        `OrigID: ${localId}\\r\\n` +\n        `LocalAddr: IP=${localAddr} SSRC=0x00000000\\r\\n` +\n        `RemoteAddr: IP=${remoteAddr} SSRC=0x00000000\\r\\n` +\n        `LocalMetrics:\\r\\n` +\n        `Timestamps: START=0 STOP=0\\r\\n` +\n        `SessionDesc: PT=0 PD=opus SR=0 FD=0 FPP=0 PPS=0 PLC=0 SSUP=on\\r\\n` +\n        `JitterBuffer: JBA=0 JBR=0 JBN=${JBN} JBM=${JBM} JBX=0\\r\\n` +\n        `PacketLoss: NLR=${NLR} JDR=${JDR}\\r\\n` +\n        `BurstGapLoss: BLD=0 BD=0 GLD=0 GD=0 GMIN=0\\r\\n` +\n        `Delay: RTD=0 ESD=0 SOWD=0 IAJ=0\\r\\n` +\n        `QualityEst: MOSLQ=${MOSLQ} MOSCQ=0.0\\r\\n` +\n        `DialogID: ${callID};to-tag=${toTag};from-tag=${fromTag}`\n    );\n};\n\nconst getQoSStatsTemplate = (): QosStats => ({\n    localAddr: '',\n    remoteAddr: '',\n    callID: '',\n    localID: '',\n    remoteID: '',\n    origID: '',\n    fromTag: '',\n    toTag: '',\n    timestamp: {\n        start: '',\n        stop: ''\n    },\n\n    netType: {},\n\n    packetLost: 0,\n    packetsReceived: 0,\n\n    jitterBufferNominal: 0,\n    jitterBufferMax: 0,\n\n    jitterBufferDiscardRate: 0,\n\n    totalSumJitter: 0,\n    totalIntervalCount: 0,\n\n    NLR: '',\n    JBM: 0,\n    JBN: '',\n    JDR: '',\n    MOSLQ: 0,\n\n    status: false,\n    localcandidate: {},\n    remotecandidate: {}\n});\n\nconst addToMap = (map: any = {}, key: string): any => ({\n    ...map,\n    [key]: (key in map ? parseInt(map[key]) : 0) + 1\n});\n\nenum networkTypeMap {\n    bluetooth = 'Bluetooth',\n    cellular = 'Cellulars',\n    ethernet = 'Ethernet',\n    wifi = 'WiFi',\n    vpn = 'VPN',\n    wimax = 'WiMax',\n    '2g' = '2G',\n    '3g' = '3G',\n    '4g' = '4G'\n}\n\n//TODO: find relaible way to find network type , use navigator.connection.type?\nconst getNetworkType = (connectionType): networkTypeMap => {\n    const sysNetwork = connectionType.systemNetworkType || 'unknown';\n    const localNetwork = connectionType.local.networkType || ['unknown'];\n    const networkType = !sysNetwork || sysNetwork === 'unknown' ? localNetwork[0] : sysNetwork;\n    return networkType in networkTypeMap ? networkTypeMap[networkType] : networkType;\n};\n\nexport interface QosStats {\n    localAddr: string;\n    remoteAddr: string;\n    callID: string;\n    localID: string;\n    remoteID: string;\n    origID: string;\n    fromTag: string;\n    toTag: string;\n    timestamp: {\n        start: string;\n        stop: string;\n    };\n\n    netType: any;\n\n    packetLost: number;\n    packetsReceived: number;\n\n    jitterBufferNominal: number;\n    jitterBufferMax: number;\n\n    jitterBufferDiscardRate: number;\n\n    totalSumJitter: number;\n    totalIntervalCount: number;\n\n    NLR: string;\n    JBM: number;\n    JBN: string;\n    JDR: string;\n    MOSLQ: number;\n\n    status: boolean;\n\n    localcandidate: any;\n    remotecandidate: any;\n}\n","module.exports = __WEBPACK_EXTERNAL_MODULE__11__;","export type RTPReport = {\n    inboundRtpReport?: InboundRtpReport;\n    outboundRtpReport?: OutboundRtpReport;\n    rttMs?: RttReport;\n};\n\nexport type InboundRtpReport = {\n    mediaType?: string;\n    packetsReceived?: number;\n    bytesReceived?: number;\n    packetsLost?: number;\n    jitter?: number;\n};\n\nexport type OutboundRtpReport = {\n    mediaType?: string;\n    packetsSent?: number;\n    bytesSent?: number;\n};\n\nexport type RttReport = {\n    currentRoundTripTime?: number;\n};\n\nexport function isNoAudio(report: RTPReport): boolean {\n    if (!report.inboundRtpReport) {\n        return true;\n    }\n    if (!report.outboundRtpReport) {\n        return true;\n    }\n    if (report.inboundRtpReport.packetsReceived === 0 || report.outboundRtpReport.packetsSent === 0) {\n        return true;\n    }\n    return false;\n}\n","import {UA, Transport} from 'sip.js';\nimport {delay} from './utils';\n\nexport interface WebPhoneSIPTransport extends Transport {\n    computeRandomTimeout: typeof computeRandomTimeout;\n    reconnect: typeof reconnect;\n    isSipErrorCode: typeof isSipErrorCode;\n    scheduleSwitchBackMainProxy: typeof scheduleSwitchBackMainProxy;\n    onSipErrorCode: typeof onSipErrorCode;\n    reconnectionAttempts?: number;\n    logger: typeof UA.prototype.logger;\n    switchBackInterval?: number;\n    getNextWsServer: any;\n    noAvailableServers: any;\n    status: number;\n    resetServerErrorStatus: any;\n    configuration: typeof UA.prototype.configuration.transportOptions;\n    nextReconnectInterval: number;\n    sipErrorCodes?: string[];\n    __isCurrentMainProxy: typeof __isCurrentMainProxy;\n    __onConnectedToMain: typeof __onConnectedToMain;\n    __onConnectedToBackup: typeof __onConnectedToBackup;\n    __clearSwitchBackTimer: typeof __clearSwitchBackTimer;\n    __connect: typeof Transport.prototype.connect;\n    connect: typeof __connect;\n    reconnectTimer: any;\n    disposeWs: () => void;\n    onError: (e: any) => void;\n    mainProxy: any;\n}\n\nexport const TransportConstructorWrapper = (SipTransportConstructor: any, webPhoneOptions: any): any => {\n    return (logger: typeof UA.prototype.logger, options: any): WebPhoneSIPTransport => {\n        const transport = new SipTransportConstructor(logger, options);\n\n        transport.nextReconnectInterval = 0;\n        transport.sipErrorCodes = webPhoneOptions.sipErrorCodes;\n        transport.switchBackInterval = webPhoneOptions.switchBackInterval;\n        transport.mainProxy = transport.configuration.wsServers[0];\n\n        transport.computeRandomTimeout = computeRandomTimeout;\n        transport.reconnect = reconnect.bind(transport);\n        transport.isSipErrorCode = isSipErrorCode.bind(transport);\n        transport.scheduleSwitchBackMainProxy = scheduleSwitchBackMainProxy.bind(transport);\n        transport.onSipErrorCode = onSipErrorCode.bind(transport);\n        transport.__isCurrentMainProxy = __isCurrentMainProxy.bind(transport);\n        transport.__afterWSConnected = __afterWSConnected.bind(transport);\n        transport.__onConnectedToBackup = __onConnectedToBackup.bind(transport);\n        transport.__onConnectedToMain = __onConnectedToMain.bind(transport);\n        transport.__clearSwitchBackTimer = __clearSwitchBackTimer.bind(transport);\n        transport.__connect = transport.connect;\n        transport.connect = __connect.bind(transport);\n\n        transport.on('connected', transport.__afterWSConnected);\n\n        return transport;\n    };\n};\n\nconst C = {\n    // Transport status codes\n    STATUS_CONNECTING: 0,\n    STATUS_OPEN: 1,\n    STATUS_CLOSING: 2,\n    STATUS_CLOSED: 3\n};\n\nvar computeRandomTimeout = (reconnectionAttempts = 1, randomMinInterval = 0, randomMaxInterval = 0): number => {\n    if (randomMinInterval < 0 || randomMaxInterval < 0 || reconnectionAttempts < 1) {\n        throw new Error('Arguments must be positive numbers');\n    }\n\n    const randomInterval =\n        Math.floor(Math.random() * Math.abs(randomMaxInterval - randomMinInterval)) + randomMinInterval;\n    const retryOffset = ((reconnectionAttempts - 1) * (randomMinInterval + randomMaxInterval)) / 2;\n\n    return randomInterval + retryOffset;\n};\n\nasync function __connect(this: WebPhoneSIPTransport, options?: any): Promise<void> {\n    return await this.__connect(options).catch(async err => {\n        this.emit('wsConnectionError', err);\n        this.logger.warn('Connection Error occured. Trying to reconnect to websocket...');\n        this.onError(err);\n        this.disconnect({force: true});\n        this.disposeWs();\n        await this.reconnect();\n    });\n}\n\nasync function reconnect(this: WebPhoneSIPTransport, forceReconnectToMain?: boolean): Promise<void> {\n    if (this.reconnectionAttempts > 0) {\n        this.logger.warn('Reconnection attempt ' + this.reconnectionAttempts + ' failed');\n    }\n\n    if (forceReconnectToMain) {\n        this.logger.warn('forcing connect to main WS server');\n        await this.disconnect({force: true});\n        this.server = this.getNextWsServer(true);\n        this.reconnectionAttempts = 0;\n        await this.connect();\n        return;\n    }\n\n    if (this.noAvailableServers()) {\n        this.logger.warn('no available ws servers left - going to closed state');\n        this.status = C.STATUS_CLOSED;\n        this.emit('closed');\n        this.resetServerErrorStatus();\n        this.server = this.getNextWsServer(true);\n        this.__clearSwitchBackTimer();\n        return;\n    }\n\n    if (this.isConnected()) {\n        this.logger.warn('attempted to reconnect while connected - forcing disconnect');\n        await this.disconnect({force: true});\n        await this.reconnect();\n        return;\n    }\n\n    const randomMinInterval = (this.configuration.reconnectionTimeout - 2) * 1000;\n    const randomMaxInterval = (this.configuration.reconnectionTimeout + 2) * 1000;\n\n    this.reconnectionAttempts += 1;\n    this.nextReconnectInterval = this.computeRandomTimeout(\n        this.reconnectionAttempts,\n        randomMinInterval,\n        randomMaxInterval\n    );\n\n    if (this.reconnectionAttempts > this.configuration.maxReconnectionAttempts) {\n        this.logger.warn('maximum reconnection attempts for WebSocket ' + this.server.wsUri);\n        this.logger.warn('transport ' + this.server.wsUri + \" failed | connection state set to 'error'\");\n        this.server.isError = true;\n        this.emit('transportError');\n        this.server = this.getNextWsServer();\n        this.reconnectionAttempts = 0;\n        await this.reconnect();\n    } else {\n        this.logger.warn(\n            'trying to reconnect to WebSocket ' +\n                this.server.wsUri +\n                ' (reconnection attempt ' +\n                this.reconnectionAttempts +\n                ')'\n        );\n        this.reconnectTimer = setTimeout(() => {\n            this.connect();\n            this.reconnectTimer = undefined;\n        }, this.nextReconnectInterval);\n        this.logger.warn('next reconnection attempt in:' + Math.round(this.nextReconnectInterval / 1000) + ' seconds.');\n    }\n}\n\nfunction isSipErrorCode(this: WebPhoneSIPTransport, message: string): boolean {\n    const statusLine = message.substring(0, message.indexOf('\\r\\n'));\n    const statusCode = statusLine.split(' ')[1];\n\n    return statusCode && this.sipErrorCodes && this.sipErrorCodes.length && this.sipErrorCodes.includes(statusCode);\n}\n\nfunction scheduleSwitchBackMainProxy(this: WebPhoneSIPTransport): void {\n    const randomInterval = 15 * 60 * 1000; //15 min\n\n    let switchBackInterval = this.switchBackInterval ? this.switchBackInterval * 1000 : null;\n\n    // Add random time to expand clients connections in time;\n    if (switchBackInterval) {\n        switchBackInterval += this.computeRandomTimeout(1, 0, randomInterval);\n        this.logger.warn(\n            'Try to switch back to main proxy after ' + Math.round(switchBackInterval / 1000 / 60) + ' min'\n        );\n\n        this.mainProxy.switchBackTimer = setTimeout(() => {\n            this.mainProxy.isError = false;\n            this.mainProxy.switchBackTimer = null;\n            this.logger.warn('switchBack initiated');\n            this.emit('switchBackProxy');\n        }, switchBackInterval);\n    } else {\n        this.logger.warn('switchBackInterval is not set. Will be switched with next provision update ');\n    }\n}\n\nasync function onSipErrorCode(this: WebPhoneSIPTransport): Promise<any> {\n    this.logger.warn('Error received from the server. Disconnecting from the proxy');\n    this.server.isError = true;\n    this.emit('transportError');\n    await this.disconnect({force: true});\n    this.server = this.getNextWsServer();\n    this.reconnectionAttempts = 0;\n    return this.reconnect();\n}\n\nfunction __isCurrentMainProxy(this: WebPhoneSIPTransport): boolean {\n    return this.server === this.configuration.wsServers[0];\n}\n\nfunction __clearSwitchBackTimer(this: WebPhoneSIPTransport): void {\n    if (this.mainProxy.switchBackTimer) {\n        clearTimeout(this.mainProxy.switchBackTimer);\n        this.mainProxy.switchBackTimer = null;\n    }\n}\n\nfunction __onConnectedToMain(this: WebPhoneSIPTransport): void {\n    this.__clearSwitchBackTimer();\n}\n\nfunction __onConnectedToBackup(this: WebPhoneSIPTransport): void {\n    if (!this.mainProxy.switchBackTimer) {\n        this.scheduleSwitchBackMainProxy();\n    }\n}\n\nfunction __afterWSConnected(this: WebPhoneSIPTransport): void {\n    this.__isCurrentMainProxy() ? this.__onConnectedToMain() : this.__onConnectedToBackup();\n}\n","import {\n    PeerConnectionOptions,\n    WebSessionDescriptionHandler,\n    WebSessionDescriptionHandlerOptions\n} from 'sip.js/types/Web/session-description-handler';\nimport {EventEmitter} from 'events';\nimport {TypeStrings} from 'sip.js/lib/Enums';\nimport {Session, InviteClientContext, InviteServerContext, Utils, Exceptions, UA} from 'sip.js';\nimport {BodyObj} from 'sip.js/lib/Web/SessionDescriptionHandler';\nimport {\n    SessionDescriptionHandler as SessionDescriptionHandlerDefinition,\n    SessionDescriptionHandlerModifiers,\n    SessionDescriptionHandlerOptions,\n    SessionDescriptionHandlerObserver\n} from 'sip.js/lib/Web/SessionDescriptionHandlerObserver';\nimport * as Modifiers from 'sip.js/lib/Web/Modifiers';\n\nimport {Logger} from 'sip.js/types/logger-factory';\n\n//TODO vyshakhbabji Check this\n// import {Utils} from 'sip.js/types/utils';\n\nexport class DefaultSessionDescriptionHandler extends EventEmitter implements WebSessionDescriptionHandler {\n    /**\n     * @param {SIP.Session} session\n     * @param {Object} [options]\n     */\n    public static defaultFactory(\n        session: InviteClientContext | InviteServerContext,\n        options: any\n    ): DefaultSessionDescriptionHandler {\n        const logger: Logger = session.ua.getLogger('sip.invitecontext.sessionDescriptionHandler', session.id);\n        const observer: SessionDescriptionHandlerObserver = new SessionDescriptionHandlerObserver(session, options);\n        return new DefaultSessionDescriptionHandler(logger, observer, options);\n    }\n\n    public type: TypeStrings;\n    public peerConnection!: RTCPeerConnection;\n    private options: any;\n    private logger: Logger;\n    private observer: SessionDescriptionHandlerObserver;\n    private dtmfSender: any;\n    private shouldAcquireMedia: boolean;\n    private CONTENT_TYPE: string;\n    private direction: string;\n    private C: any;\n    private modifiers: SessionDescriptionHandlerModifiers;\n    private WebRTC: any;\n    //TODO:Check this\n    private iceGatheringDeferred: Utils.Deferred<any> | undefined;\n    private iceGatheringTimeout: boolean;\n    private iceGatheringTimer: any | undefined;\n    private constraints: any;\n\n    constructor(logger: Logger, observer: SessionDescriptionHandlerObserver, options: any) {\n        super();\n        this.type = TypeStrings.SessionDescriptionHandler;\n        // TODO: Validate the options\n        this.options = options || {};\n\n        this.logger = logger;\n        this.observer = observer;\n        this.dtmfSender = undefined;\n\n        this.shouldAcquireMedia = true;\n\n        this.CONTENT_TYPE = 'application/sdp';\n\n        this.C = {\n            DIRECTION: {\n                NULL: null,\n                SENDRECV: 'sendrecv',\n                SENDONLY: 'sendonly',\n                RECVONLY: 'recvonly',\n                INACTIVE: 'inactive'\n            }\n        };\n\n        this.logger.log('SessionDescriptionHandlerOptions: ' + JSON.stringify(this.options));\n\n        this.direction = this.C.DIRECTION.NULL;\n\n        this.modifiers = this.options.modifiers || [];\n        if (!Array.isArray(this.modifiers)) {\n            this.modifiers = [this.modifiers];\n        }\n\n        const environment = (global as any).window || global;\n        this.WebRTC = {\n            MediaStream: environment.MediaStream,\n            getUserMedia: environment.navigator.mediaDevices.getUserMedia.bind(environment.navigator.mediaDevices),\n            RTCPeerConnection: environment.RTCPeerConnection\n        };\n\n        this.iceGatheringTimeout = false;\n\n        this.initPeerConnection(this.options.peerConnectionOptions);\n\n        this.constraints = this.checkAndDefaultConstraints(this.options.constraints);\n    }\n\n    // Functions the sesssion can use\n\n    /**\n     * Destructor\n     */\n    public close(): void {\n        this.logger.log('closing PeerConnection');\n        // have to check signalingState since this.close() gets called multiple times\n        if (this.peerConnection && this.peerConnection.signalingState !== 'closed') {\n            if (this.peerConnection.getSenders) {\n                this.peerConnection.getSenders().forEach((sender: any) => {\n                    if (sender.track) {\n                        sender.track.stop();\n                    }\n                });\n            } else {\n                this.logger.warn('Using getLocalStreams which is deprecated');\n                (this.peerConnection as any).getLocalStreams().forEach((stream: any) => {\n                    stream.getTracks().forEach((track: any) => {\n                        track.stop();\n                    });\n                });\n            }\n            if (this.peerConnection.getReceivers) {\n                this.peerConnection.getReceivers().forEach((receiver: any) => {\n                    if (receiver.track) {\n                        receiver.track.stop();\n                    }\n                });\n            } else {\n                this.logger.warn('Using getRemoteStreams which is deprecated');\n                (this.peerConnection as any).getRemoteStreams().forEach((stream: any) => {\n                    stream.getTracks().forEach((track: any) => {\n                        track.stop();\n                    });\n                });\n            }\n            this.resetIceGatheringComplete();\n            this.peerConnection.close();\n        }\n    }\n\n    /**\n     * Gets the local description from the underlying media implementation\n     * @param {Object} [options] Options object to be used by getDescription\n     * @param {MediaStreamConstraints} [options.constraints] MediaStreamConstraints\n     *   https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamConstraints\n     * @param {Object} [options.peerConnectionOptions] If this is set it will recreate the peer\n     *   connection with the new options\n     * @param {Array} [modifiers] Array with one time use description modifiers\n     * @returns {Promise} Promise that resolves with the local description to be used for the session\n     */\n    public getDescription(\n        options: WebSessionDescriptionHandlerOptions = {},\n        modifiers: SessionDescriptionHandlerModifiers = []\n    ): Promise<BodyObj> {\n        if (options.peerConnectionOptions) {\n            this.initPeerConnection(options.peerConnectionOptions);\n        }\n\n        // Merge passed constraints with saved constraints and save\n        let newConstraints: any = Object.assign({}, this.constraints, options.constraints);\n        newConstraints = this.checkAndDefaultConstraints(newConstraints);\n        if (JSON.stringify(newConstraints) !== JSON.stringify(this.constraints)) {\n            this.constraints = newConstraints;\n            this.shouldAcquireMedia = true;\n        }\n\n        if (!Array.isArray(modifiers)) {\n            modifiers = [modifiers];\n        }\n        modifiers = modifiers.concat(this.modifiers);\n\n        return Promise.resolve()\n            .then(() => {\n                if (this.shouldAcquireMedia) {\n                    return this.acquire(this.constraints).then(() => {\n                        this.shouldAcquireMedia = false;\n                    });\n                }\n            })\n            .then(() => this.createOfferOrAnswer(options.RTCOfferOptions, modifiers))\n            .then((description: RTCSessionDescriptionInit) => {\n                this.emit('getDescription', description);\n                return {\n                    body: description.sdp,\n                    contentType: this.CONTENT_TYPE\n                };\n            });\n    }\n\n    /**\n     * Check if the Session Description Handler can handle the Content-Type described by a SIP Message\n     * @param {String} contentType The content type that is in the SIP Message\n     * @returns {boolean}\n     */\n    public hasDescription(contentType: string): boolean {\n        return contentType === this.CONTENT_TYPE;\n    }\n\n    /**\n     * The modifier that should be used when the session would like to place the call on hold\n     * @param {String} [sdp] The description that will be modified\n     * @returns {Promise} Promise that resolves with modified SDP\n     */\n    public holdModifier(description: RTCSessionDescriptionInit): Promise<RTCSessionDescriptionInit> {\n        if (!description.sdp) {\n            return Promise.resolve(description);\n        }\n\n        if (!/a=(sendrecv|sendonly|recvonly|inactive)/.test(description.sdp)) {\n            description.sdp = description.sdp.replace(/(m=[^\\r]*\\r\\n)/g, '$1a=sendonly\\r\\n');\n        } else {\n            description.sdp = description.sdp.replace(/a=sendrecv\\r\\n/g, 'a=sendonly\\r\\n');\n            description.sdp = description.sdp.replace(/a=recvonly\\r\\n/g, 'a=inactive\\r\\n');\n        }\n        return Promise.resolve(description);\n    }\n\n    /**\n     * Set the remote description to the underlying media implementation\n     * @param {String} sessionDescription The description provided by a SIP message to be set on the media implementation\n     * @param {Object} [options] Options object to be used by getDescription\n     * @param {MediaStreamConstraints} [options.constraints] MediaStreamConstraints\n     *   https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamConstraints\n     * @param {Object} [options.peerConnectionOptions] If this is set it will recreate the peer\n     *   connection with the new options\n     * @param {Array} [modifiers] Array with one time use description modifiers\n     * @returns {Promise} Promise that resolves once the description is set\n     */\n    public setDescription(\n        sessionDescription: string,\n        options: WebSessionDescriptionHandlerOptions = {},\n        modifiers: SessionDescriptionHandlerModifiers = []\n    ): Promise<void> {\n        if (options.peerConnectionOptions) {\n            this.initPeerConnection(options.peerConnectionOptions);\n        }\n\n        if (!Array.isArray(modifiers)) {\n            modifiers = [modifiers];\n        }\n        modifiers = modifiers.concat(this.modifiers);\n\n        const description: RTCSessionDescriptionInit = {\n            type: this.hasOffer('local') ? 'answer' : 'offer',\n            sdp: sessionDescription\n        };\n\n        return Promise.resolve()\n            .then(() => {\n                // Media should be acquired in getDescription unless we need to do it sooner for some reason (FF61+)\n                if (this.shouldAcquireMedia && this.options.alwaysAcquireMediaFirst) {\n                    return this.acquire(this.constraints).then(() => {\n                        this.shouldAcquireMedia = false;\n                    });\n                }\n            })\n            .then(() => Utils.reducePromises(modifiers, description))\n            .catch(e => {\n                if (e.type === TypeStrings.SessionDescriptionHandlerError) {\n                    throw e;\n                }\n                const error = new Exceptions.SessionDescriptionHandlerError(\n                    'setDescription',\n                    e,\n                    'The modifiers did not resolve successfully'\n                );\n                this.logger.error(error.message);\n                this.emit('peerConnection-setRemoteDescriptionFailed', error);\n                throw error;\n            })\n            .then(modifiedDescription => {\n                this.emit('setDescription', modifiedDescription);\n                return this.peerConnection.setRemoteDescription(modifiedDescription);\n            })\n            .catch(e => {\n                if (e.type === TypeStrings.SessionDescriptionHandlerError) {\n                    throw e;\n                }\n                // Check the original SDP for video, and ensure that we have want to do audio fallback\n                if (/^m=video.+$/gm.test(sessionDescription) && !options.disableAudioFallback) {\n                    // Do not try to audio fallback again\n                    options.disableAudioFallback = true;\n                    // Remove video first, then do the other modifiers\n                    return this.setDescription(sessionDescription, options, [Modifiers.stripVideo].concat(modifiers));\n                }\n                const error = new Exceptions.SessionDescriptionHandlerError('setDescription', e);\n                if (error.error) {\n                    this.logger.error(error.error);\n                }\n                this.emit('peerConnection-setRemoteDescriptionFailed', error);\n                throw error;\n            })\n            .then(() => {\n                if (this.peerConnection.getReceivers) {\n                    this.emit('setRemoteDescription', this.peerConnection.getReceivers());\n                } else {\n                    this.emit('setRemoteDescription', (this.peerConnection as any).getRemoteStreams());\n                }\n                this.emit('confirmed', this);\n            });\n    }\n\n    /**\n     * Send DTMF via RTP (RFC 4733)\n     * @param {String} tones A string containing DTMF digits\n     * @param {Object} [options] Options object to be used by sendDtmf\n     * @returns {boolean} true if DTMF send is successful, false otherwise\n     */\n    public sendDtmf(tones: string, options: any = {}): boolean {\n        if (!this.dtmfSender && this.hasBrowserGetSenderSupport()) {\n            const senders = this.peerConnection.getSenders();\n            if (senders.length > 0) {\n                this.dtmfSender = senders[0].dtmf;\n            }\n        }\n        if (!this.dtmfSender && this.hasBrowserTrackSupport()) {\n            const streams = (this.peerConnection as any).getLocalStreams();\n            if (streams.length > 0) {\n                const audioTracks = streams[0].getAudioTracks();\n                if (audioTracks.length > 0) {\n                    this.dtmfSender = (this.peerConnection as any).createDTMFSender(audioTracks[0]);\n                }\n            }\n        }\n        if (!this.dtmfSender) {\n            return false;\n        }\n        try {\n            this.dtmfSender.insertDTMF(tones, options.duration, options.interToneGap);\n        } catch (e) {\n            if (e.type === 'InvalidStateError' || e.type === 'InvalidCharacterError') {\n                this.logger.error(e);\n                return false;\n            }\n            throw e;\n        }\n        this.logger.log('DTMF sent via RTP: ' + tones.toString());\n        return true;\n    }\n\n    /**\n     * Get the direction of the session description\n     * @returns {String} direction of the description\n     */\n    public getDirection(): string {\n        return this.direction;\n    }\n\n    // Internal functions\n    private createOfferOrAnswer(\n        RTCOfferOptions: any = {},\n        modifiers: SessionDescriptionHandlerModifiers = []\n    ): Promise<RTCSessionDescriptionInit> {\n        const methodName: string = this.hasOffer('remote') ? 'createAnswer' : 'createOffer';\n        const pc = this.peerConnection;\n\n        this.logger.log(methodName);\n\n        return pc[methodName](RTCOfferOptions)\n            .catch((e: any) => {\n                if (e.type === TypeStrings.SessionDescriptionHandlerError) {\n                    throw e;\n                }\n                const error = new Exceptions.SessionDescriptionHandlerError(\n                    'createOfferOrAnswer',\n                    e,\n                    'peerConnection-' + methodName + 'Failed'\n                );\n                this.emit('peerConnection-' + methodName + 'Failed', error);\n                throw error;\n            })\n            .then((sdp: RTCSessionDescriptionInit) =>\n                Utils.reducePromises(modifiers, this.createRTCSessionDescriptionInit(sdp))\n            )\n            .then((sdp: RTCSessionDescriptionInit) => {\n                this.resetIceGatheringComplete();\n                this.logger.log('Setting local sdp.');\n                this.logger.log('sdp is ' + sdp.sdp || 'undefined');\n                return pc.setLocalDescription(sdp);\n            })\n            .catch((e: any) => {\n                if (e.type === TypeStrings.SessionDescriptionHandlerError) {\n                    throw e;\n                }\n                const error = new Exceptions.SessionDescriptionHandlerError(\n                    'createOfferOrAnswer',\n                    e,\n                    'peerConnection-SetLocalDescriptionFailed'\n                );\n                this.emit('peerConnection-SetLocalDescriptionFailed', error);\n                throw error;\n            })\n            .then(() => this.waitForIceGatheringComplete())\n            .then(() => {\n                const localDescription: RTCSessionDescriptionInit = this.createRTCSessionDescriptionInit(\n                    this.peerConnection.localDescription\n                );\n                return Utils.reducePromises(modifiers, localDescription);\n            })\n            .then((localDescription: RTCSessionDescriptionInit) => {\n                this.setDirection(localDescription.sdp || '');\n                return localDescription;\n            })\n            .catch((e: any) => {\n                if (e.type === TypeStrings.SessionDescriptionHandlerError) {\n                    throw e;\n                }\n                const error = new Exceptions.SessionDescriptionHandlerError('createOfferOrAnswer', e);\n                this.logger.error(error.toString());\n                throw error;\n            });\n    }\n\n    // Creates an RTCSessionDescriptionInit from an RTCSessionDescription\n    private createRTCSessionDescriptionInit(RTCSessionDescription: any): RTCSessionDescriptionInit {\n        return {\n            type: RTCSessionDescription.type,\n            sdp: RTCSessionDescription.sdp\n        };\n    }\n\n    private addDefaultIceCheckingTimeout(peerConnectionOptions: PeerConnectionOptions): PeerConnectionOptions {\n        if (peerConnectionOptions.iceCheckingTimeout === undefined) {\n            peerConnectionOptions.iceCheckingTimeout = 5000;\n        }\n        return peerConnectionOptions;\n    }\n\n    private addDefaultIceServers(rtcConfiguration: any): any {\n        if (!rtcConfiguration.iceServers) {\n            rtcConfiguration.iceServers = [{urls: 'stun:stun.l.google.com:19302'}];\n        }\n        return rtcConfiguration;\n    }\n\n    private checkAndDefaultConstraints(constraints: any): any {\n        const defaultConstraints: any = {audio: true, video: !this.options.alwaysAcquireMediaFirst};\n\n        constraints = constraints || defaultConstraints;\n        // Empty object check\n        if (Object.keys(constraints).length === 0 && constraints.constructor === Object) {\n            return defaultConstraints;\n        }\n        return constraints;\n    }\n\n    private hasBrowserTrackSupport(): boolean {\n        return Boolean(this.peerConnection.addTrack);\n    }\n\n    private hasBrowserGetSenderSupport(): boolean {\n        return Boolean(this.peerConnection.getSenders);\n    }\n\n    private initPeerConnection(options: any = {}): void {\n        options = this.addDefaultIceCheckingTimeout(options);\n        options.rtcConfiguration = options.rtcConfiguration || {};\n        options.rtcConfiguration = this.addDefaultIceServers(options.rtcConfiguration);\n\n        this.logger.log('initPeerConnection');\n\n        if (this.peerConnection) {\n            this.logger.log('Already have a peer connection for this session. Tearing down.');\n            this.resetIceGatheringComplete();\n            this.peerConnection.close();\n        }\n\n        console.error('RTCConfiguration: ', options.rtcConfiguration);\n        this.peerConnection = new this.WebRTC.RTCPeerConnection(options.rtcConfiguration, {\n            optional: [{googDscp: true}]\n        });\n\n        this.logger.log('New peer connection created');\n        console.error('newPeerconnection', this.peerConnection);\n\n        if ('ontrack' in this.peerConnection) {\n            this.peerConnection.addEventListener('track', (e: any) => {\n                this.logger.log('track added');\n                this.observer.trackAdded();\n                this.emit('addTrack', e);\n            });\n        } else {\n            this.logger.warn('Using onaddstream which is deprecated');\n            (this.peerConnection as any).onaddstream = (e: any) => {\n                this.logger.log('stream added');\n                this.emit('addStream', e);\n            };\n        }\n\n        this.peerConnection.onicecandidate = (e: any) => {\n            this.emit('iceCandidate', e);\n            if (e.candidate) {\n                this.logger.log(\n                    'ICE candidate received: ' + (e.candidate.candidate === null ? null : e.candidate.candidate.trim())\n                );\n            } else if (e.candidate === null) {\n                // indicates the end of candidate gathering\n                this.logger.log('ICE candidate gathering complete');\n                this.triggerIceGatheringComplete();\n            }\n        };\n\n        this.peerConnection.onicegatheringstatechange = () => {\n            this.logger.log('RTCIceGatheringState changed: ' + this.peerConnection.iceGatheringState);\n            switch (this.peerConnection.iceGatheringState) {\n                case 'gathering':\n                    this.emit('iceGathering', this);\n                    if (!this.iceGatheringTimer && options.iceCheckingTimeout) {\n                        this.iceGatheringTimeout = false;\n                        this.iceGatheringTimer = setTimeout(() => {\n                            this.logger.log(\n                                'RTCIceChecking Timeout Triggered after ' + options.iceCheckingTimeout + ' milliseconds'\n                            );\n                            this.iceGatheringTimeout = true;\n                            this.triggerIceGatheringComplete();\n                        }, options.iceCheckingTimeout);\n                    }\n                    break;\n                case 'complete':\n                    this.triggerIceGatheringComplete();\n                    break;\n            }\n        };\n\n        this.peerConnection.oniceconnectionstatechange = () => {\n            let stateEvent: string;\n\n            switch (this.peerConnection.iceConnectionState) {\n                case 'new':\n                    stateEvent = 'iceConnection';\n                    break;\n                case 'checking':\n                    stateEvent = 'iceConnectionChecking';\n                    break;\n                case 'connected':\n                    stateEvent = 'iceConnectionConnected';\n                    break;\n                case 'completed':\n                    stateEvent = 'iceConnectionCompleted';\n                    break;\n                case 'failed':\n                    stateEvent = 'iceConnectionFailed';\n                    break;\n                case 'disconnected':\n                    stateEvent = 'iceConnectionDisconnected';\n                    break;\n                case 'closed':\n                    stateEvent = 'iceConnectionClosed';\n                    break;\n                default:\n                    this.logger.warn('Unknown iceConnection state: ' + this.peerConnection.iceConnectionState);\n                    return;\n            }\n            this.logger.log('ICE Connection State changed to ' + stateEvent);\n            this.emit(stateEvent, this);\n        };\n    }\n\n    private acquire(constraints: any): any {\n        // Default audio & video to true\n        constraints = this.checkAndDefaultConstraints(constraints);\n\n        return new Promise((resolve, reject) => {\n            /*\n             * Make the call asynchronous, so that ICCs have a chance\n             * to define callbacks to `userMediaRequest`\n             */\n            this.logger.log('acquiring local media');\n            this.emit('userMediaRequest', constraints);\n\n            if (constraints.audio || constraints.video) {\n                this.WebRTC.getUserMedia(constraints)\n                    .then((streams: any) => {\n                        this.observer.trackAdded();\n                        this.emit('userMedia', streams);\n                        resolve(streams);\n                    })\n                    .catch((e: any) => {\n                        this.emit('userMediaFailed', e);\n                        reject(e);\n                    });\n            } else {\n                // Local streams were explicitly excluded.\n                resolve([]);\n            }\n        })\n            .catch(e => {\n                if (e.type === TypeStrings.SessionDescriptionHandlerError) {\n                    throw e;\n                }\n                const error = new Exceptions.SessionDescriptionHandlerError('acquire', e, 'unable to acquire streams');\n                this.logger.error(error.message);\n                if (error.error) {\n                    this.logger.error(error.error);\n                }\n                throw error;\n            })\n            .then(streams => {\n                this.logger.log('acquired local media streams');\n                try {\n                    // Remove old tracks\n                    if (this.peerConnection.removeTrack) {\n                        this.peerConnection.getSenders().forEach((sender: any) => {\n                            this.peerConnection.removeTrack(sender);\n                        });\n                    }\n                    return streams;\n                } catch (e) {\n                    return Promise.reject(e);\n                }\n            })\n            .catch(e => {\n                if (e.type === TypeStrings.SessionDescriptionHandlerError) {\n                    throw e;\n                }\n                const error = new Exceptions.SessionDescriptionHandlerError('acquire', e, 'error removing streams');\n                this.logger.error(error.message);\n                if (error.error) {\n                    this.logger.error(error.error);\n                }\n                throw error;\n            })\n            .then((streams: any) => {\n                try {\n                    streams = [].concat(streams);\n                    streams.forEach((stream: any) => {\n                        if (this.peerConnection.addTrack) {\n                            stream.getTracks().forEach((track: any) => {\n                                this.peerConnection.addTrack(track, stream);\n                            });\n                        } else {\n                            // Chrome 59 does not support addTrack\n                            (this.peerConnection as any).addStream(stream);\n                        }\n                    });\n\n                    this.peerConnection\n                        .getSenders()\n                        .filter(sender => sender.track)\n                        .forEach(sender => {\n                            const params = sender.getParameters();\n                            console.error('getsender params =', params);\n                            params.priority = 'high';\n                            sender.setParameters(params).catch(error => {\n                                console.error(\n                                    `Error while setting encodings parameters for ${sender.track.kind} Track ${\n                                        sender.track.id\n                                    }: ${error.message || error.name}`\n                                );\n                            });\n                        });\n\n                } catch (e) {\n                    return Promise.reject(e);\n                }\n                return Promise.resolve();\n            })\n            .catch(e => {\n                if (e.type === TypeStrings.SessionDescriptionHandlerError) {\n                    throw e;\n                }\n                const error = new Exceptions.SessionDescriptionHandlerError('acquire', e, 'error adding stream');\n                this.logger.error(error.message);\n                if (error.error) {\n                    this.logger.error(error.error);\n                }\n                throw error;\n            });\n    }\n\n    private hasOffer(where: string): boolean {\n        const offerState: string = 'have-' + where + '-offer';\n        return this.peerConnection.signalingState === offerState;\n    }\n\n    // ICE gathering state handling\n    private isIceGatheringComplete(): boolean {\n        return this.peerConnection.iceGatheringState === 'complete' || this.iceGatheringTimeout;\n    }\n\n    private resetIceGatheringComplete(): void {\n        this.iceGatheringTimeout = false;\n\n        this.logger.log('resetIceGatheringComplete');\n\n        if (this.iceGatheringTimer) {\n            clearTimeout(this.iceGatheringTimer);\n            this.iceGatheringTimer = undefined;\n        }\n        if (this.iceGatheringDeferred) {\n            this.iceGatheringDeferred.reject();\n            this.iceGatheringDeferred = undefined;\n        }\n    }\n\n    private setDirection(sdp: string): void {\n        const match = sdp.match(/a=(sendrecv|sendonly|recvonly|inactive)/);\n        if (match === null) {\n            this.direction = this.C.DIRECTION.NULL;\n            this.observer.directionChanged();\n            return;\n        }\n        const direction = match[1];\n        switch (direction) {\n            case this.C.DIRECTION.SENDRECV:\n            case this.C.DIRECTION.SENDONLY:\n            case this.C.DIRECTION.RECVONLY:\n            case this.C.DIRECTION.INACTIVE:\n                this.direction = direction;\n                break;\n            default:\n                this.direction = this.C.DIRECTION.NULL;\n                break;\n        }\n        this.observer.directionChanged();\n    }\n\n    private triggerIceGatheringComplete(): void {\n        if (this.isIceGatheringComplete()) {\n            this.emit('iceGatheringComplete', this);\n\n            if (this.iceGatheringTimer) {\n                clearTimeout(this.iceGatheringTimer);\n                this.iceGatheringTimer = undefined;\n            }\n            if (this.iceGatheringDeferred) {\n                this.iceGatheringDeferred.resolve();\n                this.iceGatheringDeferred = undefined;\n            }\n        }\n    }\n\n    private waitForIceGatheringComplete(): Promise<any> {\n        this.logger.log('waitForIceGatheringComplete');\n        if (this.isIceGatheringComplete()) {\n            this.logger.log('ICE is already complete. Return resolved.');\n            return Promise.resolve();\n        }\n        //TODO:Check this\n        // else if (!this.iceGatheringDeferred) {\n        //     // this.iceGatheringDeferred = Utils.defer();\n        // }\n        this.logger.log('ICE is not complete. Returning promise');\n        return this.iceGatheringDeferred ? this.iceGatheringDeferred.promise : Promise.resolve();\n    }\n}\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction $getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return $getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = $getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  var args = [];\n  for (var i = 0; i < arguments.length; i++) args.push(arguments[i]);\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    ReflectApply(this.listener, this.target, args);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      if (typeof listener !== 'function') {\n        throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n      }\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      if (typeof listener !== 'function') {\n        throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n      }\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar stripPayload = function (sdp, payload) {\n    var mediaDescs = [];\n    var lines = sdp.split(/\\r\\n/);\n    var currentMediaDesc;\n    for (var i = 0; i < lines.length;) {\n        var line = lines[i];\n        if (/^m=(?:audio|video)/.test(line)) {\n            currentMediaDesc = {\n                index: i,\n                stripped: []\n            };\n            mediaDescs.push(currentMediaDesc);\n        }\n        else if (currentMediaDesc) {\n            var rtpmap = /^a=rtpmap:(\\d+) ([^/]+)\\//.exec(line);\n            if (rtpmap && payload === rtpmap[2]) {\n                lines.splice(i, 1);\n                currentMediaDesc.stripped.push(rtpmap[1]);\n                continue; // Don't increment 'i'\n            }\n        }\n        i++;\n    }\n    for (var _i = 0, mediaDescs_1 = mediaDescs; _i < mediaDescs_1.length; _i++) {\n        var mediaDesc = mediaDescs_1[_i];\n        var mline = lines[mediaDesc.index].split(\" \");\n        // Ignore the first 3 parameters of the mline. The codec information is after that\n        for (var j = 3; j < mline.length;) {\n            if (mediaDesc.stripped.indexOf(mline[j]) !== -1) {\n                mline.splice(j, 1);\n                continue;\n            }\n            j++;\n        }\n        lines[mediaDesc.index] = mline.join(\" \");\n    }\n    return lines.join(\"\\r\\n\");\n};\nvar stripMediaDescription = function (sdp, description) {\n    var descriptionRegExp = new RegExp(\"m=\" + description + \".*$\", \"gm\");\n    var groupRegExp = new RegExp(\"^a=group:.*$\", \"gm\");\n    if (descriptionRegExp.test(sdp)) {\n        var midLineToRemove_1;\n        sdp = sdp.split(/^m=/gm).filter(function (section) {\n            if (section.substr(0, description.length) === description) {\n                midLineToRemove_1 = section.match(/^a=mid:.*$/gm);\n                if (midLineToRemove_1) {\n                    var step = midLineToRemove_1[0].match(/:.+$/g);\n                    if (step) {\n                        midLineToRemove_1 = step[0].substr(1);\n                    }\n                }\n                return false;\n            }\n            return true;\n        }).join(\"m=\");\n        var groupLine = sdp.match(groupRegExp);\n        if (groupLine && groupLine.length === 1) {\n            var groupLinePortion = groupLine[0];\n            var groupRegExpReplace = new RegExp(\"\\ *\" + midLineToRemove_1 + \"[^\\ ]*\", \"g\");\n            groupLinePortion = groupLinePortion.replace(groupRegExpReplace, \"\");\n            sdp = sdp.split(groupRegExp).join(groupLinePortion);\n        }\n    }\n    return sdp;\n};\nfunction stripTcpCandidates(description) {\n    description.sdp = (description.sdp || \"\").replace(/^a=candidate:\\d+ \\d+ tcp .*?\\r\\n/img, \"\");\n    return Promise.resolve(description);\n}\nexports.stripTcpCandidates = stripTcpCandidates;\nfunction stripTelephoneEvent(description) {\n    description.sdp = stripPayload(description.sdp || \"\", \"telephone-event\");\n    return Promise.resolve(description);\n}\nexports.stripTelephoneEvent = stripTelephoneEvent;\nfunction cleanJitsiSdpImageattr(description) {\n    description.sdp = (description.sdp || \"\").replace(/^(a=imageattr:.*?)(x|y)=\\[0-/gm, \"$1$2=[1:\");\n    return Promise.resolve(description);\n}\nexports.cleanJitsiSdpImageattr = cleanJitsiSdpImageattr;\nfunction stripG722(description) {\n    description.sdp = stripPayload(description.sdp || \"\", \"G722\");\n    return Promise.resolve(description);\n}\nexports.stripG722 = stripG722;\nfunction stripRtpPayload(payload) {\n    return function (description) {\n        description.sdp = stripPayload(description.sdp || \"\", payload);\n        return Promise.resolve(description);\n    };\n}\nexports.stripRtpPayload = stripRtpPayload;\nfunction stripVideo(description) {\n    description.sdp = stripMediaDescription(description.sdp || \"\", \"video\");\n    return Promise.resolve(description);\n}\nexports.stripVideo = stripVideo;\nfunction addMidLines(description) {\n    var sdp = description.sdp || \"\";\n    if (sdp.search(/^a=mid.*$/gm) === -1) {\n        var mlines_1 = sdp.match(/^m=.*$/gm);\n        var sdpArray_1 = sdp.split(/^m=.*$/gm);\n        if (mlines_1) {\n            mlines_1.forEach(function (elem, idx) {\n                mlines_1[idx] = elem + \"\\na=mid:\" + idx;\n            });\n        }\n        sdpArray_1.forEach(function (elem, idx) {\n            if (mlines_1 && mlines_1[idx]) {\n                sdpArray_1[idx] = elem + mlines_1[idx];\n            }\n        });\n        sdp = sdpArray_1.join(\"\");\n        description.sdp = sdp;\n    }\n    return Promise.resolve(description);\n}\nexports.addMidLines = addMidLines;\n"],"sourceRoot":""}